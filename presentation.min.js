!function(){"use strict";var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function e(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return(i=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function s(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s}function a(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||((o=o||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}var t,n=(l.flatten=function(e){var t={};return l.flattenRecursively(e,t,""),t},l.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},l.mergeDeep=function(e){for(var t,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];if(!n.length)return e;var r=n.shift();if(this.isObject(e)&&this.isObject(r))for(var i in r)this.isObject(r[i])?(e[i]||Object.assign(e,((t={})[i]={},t)),this.mergeDeep(e[i],r[i])):Object.assign(e,((t={})[i]=r[i],t));return this.mergeDeep.apply(this,a([e],s(n),!1))},l.flattenRecursively=function(e,t,n){if(void 0===n&&(n=""),"string"==typeof e)t[n]=e;else if(Array.isArray(e))for(var o=0;o<e.length;o++){var r=e[o],i=n;l.flattenRecursively(r,t,i+="["+o+"]")}else if("object"==typeof e)for(o=0;o<Object.keys(e).length;o++){var s=Object.keys(e)[o];""!==(i=n).trim()&&(i+="."),i+=s,l.flattenRecursively(e[s],t,i)}},l);function l(){}(p=p=p||{}).PRESENTATION="presentation",p.PREVIEW="preview",p.CONFIG="config",p.HANDLEBAR="handlebar",p.PROXY="proxy",(p=c=c||{}).PRESENTATION="./presentation.min.js",p.PREVIEW="./preview.min.js",p.HANDLEBAR="./handlebars.min.js",p.PROXY="./proxy.min.js",(c=t=t||{}).PRESENTATION="msft-presentation.js",c.HANDLEBAR="msft-handlebars.js",(p=u=u||{}).PATH="path",p.VARIABLE="variable";var r,c=function(e){this.state=e||{config:{},debug:{logs:[],events:[]},custom:{}}},u=(e(S,r=c),Object.defineProperty(S.prototype,"debugInfo",{get:function(){return this.state.debug},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"config",{get:function(){return this.state.config},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"userConsent",{get:function(){return this.state.custom.userConsent},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"isHeadless",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"isPreviewMode",{get:function(){var e;return(null===(e=this.state.config.initConfig)||void 0===e?void 0:e.preview)||!1},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"isLivePreviewMode",{get:function(){var e;return"ConsentLivePreview"===(null===(e=window.parent)||void 0===e?void 0:e.name)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"presentationVariable",{get:function(){return t.PRESENTATION},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"handlebarVariable",{get:function(){return t.HANDLEBAR},enumerable:!1,configurable:!0}),S);function S(e){return r.call(this,e)||this}var d,p=(e(_,d=c),_.prototype.saveDebugInfo=function(e){var t=e.event,e=e.log;t&&this.state.debug.events.push(t),e&&this.state.debug.logs.push(e)},_.prototype.setUserConsent=function(e){this.state.custom.userConsent=e},_.prototype.setInitConfig=function(e){this.state.config.initConfig=e},_);function _(e){return d.call(this,e)||this}var w,c=(new c).state,g={getters:new u(c),reducers:new p(c),addReducers:function(e){this.reducers=n.mergeDeep(this.reducers,e)},addGetters:function(e){Object.defineProperties(this.getters,Object.getOwnPropertyDescriptors(e.prototype))}};(c=w=w||{})[c.INFO=0]="INFO",c[c.WARN=1]="WARN",c[c.ERROR=2]="ERROR";var f=(m.log=function(e,t){switch(e){case w.WARN:console.warn(t);break;case w.ERROR:console.error(t)}},m);function m(){}var T,h,y,v,M,C,F,D,b,K,E=(O.info=function(e,t){O.log(w.INFO,e,t)},O.warn=function(e,t){O.log(w.WARN,e,t)},O.error=function(e,t){O.log(w.ERROR,e,t)},O.log=function(e,t,n){n=O.formatLogMessage(e,t,n);g.reducers.saveDebugInfo({log:n}),f.log(e,n)},O.formatLogMessage=function(e,t,n){n=n?"| "+JSON.stringify(n):"";return"["+w[e]+"] "+t+" "+n},O);function O(){}function N(){N.registerShowTemplateHandlers()}(T=T=T||{}).Explicit="Explicit",T.Implicit="Implicit",(h=h=h||{}).ConsentChanged="ConsentChanged",h.ShowChangeSettingsModal="ShowChangeSettingsModal",h.ShowConsentNotice="ConsentNotice",h.CloseChangeSettingsModal="CloseChangeSettingsModal",h.CloseConsentNotice="CloseConsentNotice",h.AcceptAll="AcceptAll",h.RejectAll="RejectAll",h.ShowTemplate="ShowTemplate",h.CloseTemplate="CloseTemplate",h.UpdateConsent="UpdateConsent",(y=y=y||{}).Init="Init",y.CoreConsentModelSelected="CoreConsentModelSelected",y.ConfigReady="ConfigReady",(v=v=v||{}).Default="Default",v.HeadLess="HeadLess",(M=M=M||{}).Url="Url",M.Text="Text",(C=C=C||{}).ConsentNotice="consentNotice",C.ChangeSettingsModal="preferenceCenter",(F=F=F||{}).OFF="0",F.ON="1",(b=b=b||{}).Script="script",b.IFrame="iframe",(b=D=D||{}).TrackerCategory="trackerCategory",b.Banner="banner",b.CookieSettingsSummary="cookieSettingsSummary",(K=K||{}).TemplateError="There is something wrong with template. Please check logs.",new(N.registerShowTemplateHandlers=function(){window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.PublicEvents.ShowChangeSettingsModal,N.showChangeSettingsModal),window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.PublicEvents.ShowConsentNotice,N.showConsentNotice),window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.PublicEvents.CloseChangeSettingsModal,N.hideChangeSettingsModal),window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.PublicEvents.CloseConsentNotice,N.hideConsentNotice),window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.Events.Init,N.saveStylesOnInit),window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.PublicEvents.ShowTemplate,N.showTemplate),window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.PublicEvents.CloseTemplate,N.closeTemplate),window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.Events.ConfigReady,N.init)},N.showTemplate=function(e){e=e.templateId;if(!window.__MSFT_SDK.Store.getters.components||!window.__MSFT_SDK.Store.getters.components[e])throw new Error("Template : "+e+" not found.");N.showTemplateInIFrame(window.__MSFT_SDK.Store.getters.components[e],e,N.getParentElement(e))},N.closeTemplate=function(e){e=e.templateId;N.closeIFrame(e)},N.saveStylesOnInit=function(e){e.styles&&(window.__MSFT_SDK.Logger.info("user provided styles persisted to window.__MSFT_SDK.Store."),window.__MSFT_SDK.Store.reducers.setStyles(e.styles))},N.getTemplateData=function(e){var t=window.__MSFT_SDK.Store.getters.translations,n=e.attributes,e=n.trackerCategories,o={},r={};return t.forEach(function(e){return r[e.noticeName]=e.translation}),o[D.TrackerCategory]=[],e.forEach(function(e){var t,e=i(i({},(null===(t=r[e.noticeName])||void 0===t?void 0:t.translations)||{}),{name:e.categoryName});o[D.TrackerCategory].push(e)}),o[D.Banner]=r[n.consentNotice].translations,o[D.CookieSettingsSummary]=r[n.preferenceCenter].translations,o["msft-script-open"]="<script>",o["msft-script-close"]="<\/script>",o},N.init=function(){var e,t,o;void 0!==window.__MSFT_SDK.Store.getters.currentConsentModel&&void 0!==window.__MSFT_SDK.Store.getters.template?(e=window.__MSFT_SDK.Store.getters.currentConsentModel,t=window.__MSFT_SDK.Store.getters.template,o=N.getTemplateData(e),t.components.forEach(function(e){var t;try{var n=window.Handlebars.compile(e.content)(o)}catch(e){window.__MSFT_SDK.Logger.error(e.message,e),n=K.TemplateError}window.__MSFT_SDK.Store.reducers.setComponents(i(i({},window.__MSFT_SDK.Store.getters.components),((t={})[e.id]=n,t)))}),window.__MSFT_SDK.Logger.info("Components updated"),N.initialized=!0):window.__MSFT_SDK.Logger.warn("Cannot call init before config is ready.")},N.showConsentNotice=function(){var e;N.initialized||N.init(),void 0!==window.__MSFT_SDK.Store.getters.currentConsentModel?void 0!==window.__MSFT_SDK.Store.getters.components&&void 0!==window.__MSFT_SDK.Store.getters.components[window.__MSFT_SDK.enums.TemplateType.ConsentNotice]?(e=window.__MSFT_SDK.Store.getters.components[window.__MSFT_SDK.enums.TemplateType.ConsentNotice],N.showTemplateInIFrame(e,window.__MSFT_SDK.enums.TemplateType.ConsentNotice,N.getParentElement(window.__MSFT_SDK.enums.TemplateType.ConsentNotice))):window.__MSFT_SDK.Logger.error("Notice template not found."):window.__MSFT_SDK.Logger.warn("Cannot call init before consent model is selected.")},N.showChangeSettingsModal=function(){var e;void 0!==window.__MSFT_SDK.Store.getters.components&&void 0!==window.__MSFT_SDK.Store.getters.components[window.__MSFT_SDK.enums.TemplateType.ChangeSettingsModal]?(window.__MSFT_SDK.EventBus.trigger(window.__MSFT_SDK.enums.PublicEvents.CloseConsentNotice),e=window.__MSFT_SDK.Store.getters.components[window.__MSFT_SDK.enums.TemplateType.ChangeSettingsModal],N.showTemplateInIFrame(e,window.__MSFT_SDK.enums.TemplateType.ChangeSettingsModal,N.getParentElement(window.__MSFT_SDK.enums.TemplateType.ChangeSettingsModal))):window.__MSFT_SDK.Logger.error("Preference center template not found.")},N.getParentElement=function(e){e=window.__MSFT_SDK.Store.getters.templateParentMap[e];return e?document.getElementById(e):null},N.showTemplateInIFrame=function(e,t,n){var o;document.getElementById(t)?E.info("Template: "+t+" is already open."):e===K.TemplateError?alert(e):(o={origin:window.origin},e="<script>var msftData = "+JSON.stringify(o)+"<\/script><script>"+window.__MSFT_SDK.Store.getters.proxyJS+"<\/script>"+e,window.__MSFT_SDK.Utils.IFrameUtils.createIFrame(e,t,n,window.__MSFT_SDK.Store.getters.styles))},N.hideConsentNotice=function(){N.closeIFrame(window.__MSFT_SDK.enums.TemplateType.ConsentNotice)},N.hideChangeSettingsModal=function(){N.closeIFrame(window.__MSFT_SDK.enums.TemplateType.ChangeSettingsModal)},N.closeIFrame=function(e){var t=document.getElementById(e);null!==(e=null==t?void 0:t.parentElement)&&void 0!==e&&e.removeChild(t)},N.initialized=!1,N),window.onmessage=function(e){var t,n;"null"===e.origin&&(n=(n=window.MSFTConsent)[e.data.method].apply(n,a([],s(e.data.params),!1)),e.data.responseId&&null!==(t=e.source)&&void 0!==t&&t.postMessage(i(i({},e.data),{response:n}),{targetOrigin:"*"}))}}();
