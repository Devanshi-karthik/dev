!function(){"use strict";(o=l=l||{}).OFF="0",o.ON="1";e.shouldScriptConsented=function(e){return null!==e&&0<e.split(",").length&&this.consentCategoriesPending(e)},e.shouldIFrameConsented=function(e){return null!==e&&0<e.split(",").length&&this.consentCategoriesPending(e)},e.consentCategoriesPending=function(e){return null!=e&&(null!=(e=e.split(",").filter(function(e){var t;return!((null==(t=window.__MSFT_SDK.Store.getters.userConsent)?void 0:t.preferences[e])===l.ON)}))&&0<e.length)},e.shouldbeUnblocked=function(e){return null==e||(null==(e=e.split(",").filter(function(e){var t;return!((null==(t=window.__MSFT_SDK.Store.getters.userConsent)?void 0:t.preferences[e])===l.ON)}))||0==e.length)},e.shouldScriptUnblocked=function(e,t){return null!==e&&e===this.SCRIPT_BLOCKING_TYPE_ATTRIBUTE_VALUE&&this.shouldbeUnblocked(t)},e.shouldIFrameUnblocked=function(e,t){return null!==e&&this.shouldbeUnblocked(t)},e.SCRIPT_BLOCKING_TYPE_ATTRIBUTE_VALUE="text/blocked",e.MSFT_CONSENT_CATEGORIES_ATTRIBUTE="msft-consent-categories",e.SRC_ATTRIBUTE="src",e.DATASET_SRC_ATTRIBUTE="data-src",e.SCRIPT_TYPE_ATTRIBUTE="type",e.MSFT_POST_CONSENT_SCRIPT_TYPE_ATTRIBUTE="msft-post-consent-type",e.MSFT_CONSENT_IGNORE_ATTRIBUTE="msft-ignore-consent";var l,u=e;function e(){}function n(){this.domObserver=null}n.mutationCallback=function(e){e.forEach(function(e){e.addedNodes.forEach(function(t){try{1===t.nodeType&&!1===t.hasAttribute(u.MSFT_CONSENT_IGNORE_ATTRIBUTE)&&(t.nodeName.toLowerCase()===window.__MSFT_SDK.enums.RegisteredDivType.Script?n.scriptMutationObserver(t):t.nodeName.toLowerCase()===window.__MSFT_SDK.enums.RegisteredDivType.IFrame&&n.iframeMutationObserver(t))}catch(e){console.warn("Failed to block the node ",t.nodeName,"with error ",e),window.__MSFT_SDK.Logger.warn("Failed to block tag "+t.nodeName)}})})},n.scriptMutationObserver=function(t){function n(e){t.getAttribute(u.SCRIPT_TYPE_ATTRIBUTE)===u.SCRIPT_BLOCKING_TYPE_ATTRIBUTE_VALUE&&e.preventDefault(),t.removeEventListener("beforescriptexecute",n)}var e=t.type,r=t.getAttribute(u.MSFT_CONSENT_CATEGORIES_ATTRIBUTE);u.shouldScriptConsented(r)&&(t.setAttribute(u.MSFT_POST_CONSENT_SCRIPT_TYPE_ATTRIBUTE,e),t.setAttribute(u.SCRIPT_TYPE_ATTRIBUTE,u.SCRIPT_BLOCKING_TYPE_ATTRIBUTE_VALUE));t.addEventListener("beforescriptexecute",n)},n.iframeMutationObserver=function(e){var t=e.src,n=e.getAttribute(u.MSFT_CONSENT_CATEGORIES_ATTRIBUTE);u.shouldIFrameConsented(n)&&(e.removeAttribute(u.SRC_ATTRIBUTE),e.setAttribute(u.DATASET_SRC_ATTRIBUTE,t))},n.unblock=function(){window.__MSFT_SDK.Logger.info("Tracker Blocking unblock is started"),n.unblockScripts(),n.unblockIFrames()},n.unblockScripts=function(){document.querySelectorAll("script[".concat(u.MSFT_CONSENT_CATEGORIES_ATTRIBUTE,"][").concat(u.SCRIPT_TYPE_ATTRIBUTE,'="').concat(u.SCRIPT_BLOCKING_TYPE_ATTRIBUTE_VALUE,'"]:not([').concat(u.MSFT_CONSENT_CATEGORIES_ATTRIBUTE,'=""])')).forEach(function(e){var t=e;try{var n=t.getAttribute(u.MSFT_CONSENT_CATEGORIES_ATTRIBUTE),r=null==n?void 0:n.split(",").filter(function(e){var t;return!((null==(t=window.__MSFT_SDK.Store.getters.userConsent)?void 0:t.preferences[e])===l.ON)});if(null==r||0===r.length){for(var o=null!=(o=t.getAttribute(u.MSFT_POST_CONSENT_SCRIPT_TYPE_ATTRIBUTE))?o:"application/javascript",T=t.parentNode,i=(null!=T&&T.removeChild(t),document.createElement("script")),c=0;c<t.attributes.length;c++){var _=t.attributes[c];"type"!==_.name?i.setAttribute(_.name,t.attributes[c].value):i.setAttribute(u.SCRIPT_TYPE_ATTRIBUTE,o)}i.appendChild(document.createTextNode(t.innerHTML)),(null==T?document.head:T).appendChild(i)}else window.__MSFT_SDK.Logger.info("Failed to unblock script "+t.src+"not consented for categories "+(null==r?void 0:r.toString()))}catch(e){console.warn("Failed to unblock the script ",t.src,"with error ",e),window.__MSFT_SDK.Logger.error("Failed to unblock script "+t.src)}})},n.unblockIFrames=function(){document.querySelectorAll("iframe[".concat(u.MSFT_CONSENT_CATEGORIES_ATTRIBUTE,"][").concat(u.DATASET_SRC_ATTRIBUTE,"]:not([").concat(u.MSFT_CONSENT_CATEGORIES_ATTRIBUTE,'=""][').concat(u.DATASET_SRC_ATTRIBUTE,'=""])')).forEach(function(t){try{var e,n,r,o=t.getAttribute(u.MSFT_CONSENT_CATEGORIES_ATTRIBUTE),T=null==o?void 0:o.split(",").filter(function(e){var t;return!((null==(t=window.__MSFT_SDK.Store.getters.userConsent)?void 0:t.preferences[e])===l.ON)});null==T||0===T.length?(null!=(e=t.parentNode)&&e.removeChild(t),r=null!==(r=(n=t.cloneNode(!0)).getAttribute(u.DATASET_SRC_ATTRIBUTE))?r:"",n.setAttribute(u.SRC_ATTRIBUTE,r),n.removeAttribute(u.DATASET_SRC_ATTRIBUTE),(null==e?document.head:e).appendChild(n)):window.__MSFT_SDK.Logger.info("Failed to unblock iframe "+t.src+"not consented for categories "+(null==T?void 0:T.toString()))}catch(e){console.warn("Failed to unblock the iframe ",t.src,"with error ",e),window.__MSFT_SDK.Logger.error("Failed to unblock iFrame "+t.src)}})},n.prototype.start=function(e){window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.PublicEvents.ConsentChanged,n.unblock),this.domObserver=null,e&&(this.domObserver=new MutationObserver(function(e){return n.mutationCallback(e)}),this.domObserver.observe(document.documentElement,{childList:!0,subtree:!0}),window.__MSFT_SDK.Logger.info("Started tracker blocking service"))};var t,r=new n,o=(T.getBlockingService=function(){return r},T);function T(){}window.__MSFT_SDK.Helpers.AddPublicApis(o),window.__MSFT_SDK.Helpers.exposeApis(),null!=(t=window.__MSFT_SDK.Store.getters.packageConfigurations.isTrackerBlockingEnabled)&&!t||o.getBlockingService().start(!0)}();
