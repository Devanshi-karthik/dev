(function () {
    'use strict';

    var ConsentModelType;
    (function (ConsentModelType) {
        ConsentModelType["Explicit"] = "Explicit";
        ConsentModelType["Implicit"] = "Implicit";
    })(ConsentModelType || (ConsentModelType = {}));
    var PublicEvents;
    (function (PublicEvents) {
        PublicEvents["ConsentChanged"] = "ConsentChanged";
        PublicEvents["ShowConsentNotice"] = "ShowConsentNotice";
        PublicEvents["ShowFirstPage"] = "ShowFirstPage";
        PublicEvents["CloseConsentNotice"] = "CloseConsentNotice";
        PublicEvents["AcceptAll"] = "AcceptAll";
        PublicEvents["RejectAll"] = "RejectAll";
        PublicEvents["ShowTemplate"] = "ShowTemplate";
        PublicEvents["CloseTemplate"] = "CloseTemplate";
        PublicEvents["UpdateConsent"] = "UpdateConsent";
        PublicEvents["AnchorTagClicked"] = "AnchorTagClicked";
        PublicEvents["FetchConfig"] = "FetchConfig";
        PublicEvents["QuestionsFormSubmitWithoutMetaData"] = "QuestionsFormSubmitWithoutMetaData";
        PublicEvents["QuestionsFormSubmit"] = "QuestionsFormSubmit";
        PublicEvents["ShowPreferences"] = "ShowPreferences";
    })(PublicEvents || (PublicEvents = {}));
    var Events;
    (function (Events) {
        Events["Init"] = "Init";
        Events["CoreConsentModelSelected"] = "CoreConsentModelSelected";
        Events["ConfigReady"] = "ConfigReady";
    })(Events || (Events = {}));
    var SDKMode;
    (function (SDKMode) {
        SDKMode["Default"] = "Default";
        SDKMode["HeadLess"] = "HeadLess";
    })(SDKMode || (SDKMode = {}));
    var StyleType;
    (function (StyleType) {
        StyleType["Url"] = "Url";
        StyleType["Text"] = "Text";
    })(StyleType || (StyleType = {}));
    var Preference;
    (function (Preference) {
        Preference["OFF"] = "0";
        Preference["ON"] = "1";
    })(Preference || (Preference = {}));
    var Cookie;
    (function (Cookie) {
        Cookie["Consent"] = "msft-consent";
    })(Cookie || (Cookie = {}));
    var RegisteredDivType;
    (function (RegisteredDivType) {
        RegisteredDivType["Script"] = "script";
        RegisteredDivType["IFrame"] = "iframe";
    })(RegisteredDivType || (RegisteredDivType = {}));
    var NoticeType;
    (function (NoticeType) {
        NoticeType["TrackerCategory"] = "trackerCategory";
    })(NoticeType || (NoticeType = {}));
    var ErrorStrings;
    (function (ErrorStrings) {
        ErrorStrings["TemplateError"] = "<b>There is something wrong with template. Please check logs.</b>";
    })(ErrorStrings || (ErrorStrings = {}));
    var IntervalUnits;
    (function (IntervalUnits) {
        IntervalUnits["day"] = "day";
        IntervalUnits["week"] = "week";
        IntervalUnits["month"] = "month";
        IntervalUnits["year"] = "year";
    })(IntervalUnits || (IntervalUnits = {}));
    var QuestionType;
    (function (QuestionType) {
        QuestionType["Text"] = "Text";
        QuestionType["Email"] = "Email";
        QuestionType["Radio"] = "Radio";
        QuestionType["MultiSelect"] = "MultiSelect";
        QuestionType["Select"] = "Select";
        QuestionType["Date"] = "Date";
        QuestionType["PhoneNumber"] = "PhoneNumber";
        QuestionType["CreditCard"] = "CreditCard";
        QuestionType["Number"] = "Number";
        QuestionType["MultiLineText"] = "multiLineText";
    })(QuestionType || (QuestionType = {}));
    var QuestionValidation;
    (function (QuestionValidation) {
        QuestionValidation["Required"] = "required";
    })(QuestionValidation || (QuestionValidation = {}));
    var QuestionField;
    (function (QuestionField) {
        QuestionField["Question"] = "question";
        QuestionField["Placeholder"] = "placeholder";
        QuestionField["Options"] = "options";
    })(QuestionField || (QuestionField = {}));
    var ModelKind;
    (function (ModelKind) {
        ModelKind["WebConsentModel"] = "WebConsentModel";
        ModelKind["QuestionModel"] = "DSRSubmissionModel";
    })(ModelKind || (ModelKind = {}));
    var Template;
    (function (Template) {
        Template["Preferences"] = "Preferences";
    })(Template || (Template = {}));

    var BlockingServiceUtil = /** @class */ (function () {
        function BlockingServiceUtil() {
        }
        BlockingServiceUtil.shouldScriptConsented = function (categories) {
            if (categories !== null && categories.split(',').length > 0) {
                return this.consentCategoriesPending(categories);
            }
            return false;
        };
        BlockingServiceUtil.shouldIFrameConsented = function (categories) {
            if (categories !== null && categories.split(',').length > 0) {
                return this.consentCategoriesPending(categories);
            }
            return false;
        };
        BlockingServiceUtil.consentCategoriesPending = function (categories) {
            if (categories != null) {
                var pendingConsent = categories
                    .split(',')
                    .filter(function (x) {
                    var _a;
                    return !(((_a = window.__MSFT_SDK.Store.getters.userConsent) === null || _a === void 0 ? void 0 : _a.preferences[x]) ===
                        Preference.ON);
                });
                return pendingConsent != null && pendingConsent.length > 0;
            }
            return false;
        };
        BlockingServiceUtil.shouldbeUnblocked = function (msftConsentCategories) {
            if (msftConsentCategories != null) {
                var pendingConsent = msftConsentCategories
                    .split(',')
                    .filter(function (x) {
                    var _a;
                    return !(((_a = window.__MSFT_SDK.Store.getters.userConsent) === null || _a === void 0 ? void 0 : _a.preferences[x]) ===
                        Preference.ON);
                });
                return pendingConsent == null || pendingConsent.length == 0;
            }
            return true;
        };
        BlockingServiceUtil.shouldScriptUnblocked = function (type, msftConsentCategories) {
            if (type !== null && type === this.SCRIPT_BLOCKING_TYPE_ATTRIBUTE_VALUE) {
                return this.shouldbeUnblocked(msftConsentCategories);
            }
            return false;
        };
        BlockingServiceUtil.shouldIFrameUnblocked = function (dataSrc, msftConsentCategories) {
            if (dataSrc !== null) {
                return this.shouldbeUnblocked(msftConsentCategories);
            }
            return false;
        };
        BlockingServiceUtil.SCRIPT_BLOCKING_TYPE_ATTRIBUTE_VALUE = 'text/blocked';
        BlockingServiceUtil.MSFT_CONSENT_CATEGORIES_ATTRIBUTE = 'msft-consent-categories';
        BlockingServiceUtil.SRC_ATTRIBUTE = 'src';
        BlockingServiceUtil.DATASET_SRC_ATTRIBUTE = 'data-src';
        BlockingServiceUtil.SCRIPT_TYPE_ATTRIBUTE = 'type';
        BlockingServiceUtil.MSFT_POST_CONSENT_SCRIPT_TYPE_ATTRIBUTE = 'msft-post-consent-type';
        BlockingServiceUtil.MSFT_CONSENT_IGNORE_ATTRIBUTE = 'msft-ignore-consent';
        return BlockingServiceUtil;
    }());

    var BlockingService = /** @class */ (function () {
        function BlockingService(enableMutationObserver) {
            window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.PublicEvents.ConsentChanged, BlockingService.unblock);
            this.domObserver = null;
            if (enableMutationObserver) {
                this.domObserver = new MutationObserver(function (mutationRecords) {
                    return BlockingService.mutationCallback(mutationRecords);
                });
                this.domObserver.observe(document.documentElement, {
                    childList: true,
                    subtree: true,
                });
                window.__MSFT_SDK.Logger.info('Started tracker blocking service');
            }
        }
        BlockingService.mutationCallback = function (mutationRecords) {
            mutationRecords.forEach(function (mutationRecord) {
                mutationRecord.addedNodes.forEach(function (addedNode) {
                    try {
                        if (addedNode.nodeType === 1 &&
                            addedNode.hasAttribute(BlockingServiceUtil.MSFT_CONSENT_IGNORE_ATTRIBUTE) === false) {
                            if (addedNode.nodeName.toLowerCase() ===
                                window.__MSFT_SDK.enums.RegisteredDivType.Script) {
                                BlockingService.scriptMutationObserver(addedNode);
                            }
                            else if (addedNode.nodeName.toLowerCase() ===
                                window.__MSFT_SDK.enums.RegisteredDivType.IFrame) {
                                BlockingService.iframeMutationObserver(addedNode);
                            }
                        }
                    }
                    catch (error) {
                        console.warn('Failed to block the node ', addedNode.nodeName, 'with error ', error);
                        window.__MSFT_SDK.Logger.warn('Failed to block tag ' + addedNode.nodeName);
                    }
                });
            });
        };
        BlockingService.scriptMutationObserver = function (scriptNode) {
            var type = scriptNode.type;
            var msftConsentCategories = scriptNode.getAttribute(BlockingServiceUtil.MSFT_CONSENT_CATEGORIES_ATTRIBUTE);
            if (BlockingServiceUtil.shouldScriptConsented(msftConsentCategories)) {
                scriptNode.setAttribute(BlockingServiceUtil.MSFT_POST_CONSENT_SCRIPT_TYPE_ATTRIBUTE, type);
                scriptNode.setAttribute(BlockingServiceUtil.SCRIPT_TYPE_ATTRIBUTE, BlockingServiceUtil.SCRIPT_BLOCKING_TYPE_ATTRIBUTE_VALUE);
            }
            // Firefox has this additional event which prevents scripts from being executed
            var beforeScriptExecuteListener = function (event) {
                // Prevent only marked scripts from executing
                if (scriptNode.getAttribute(BlockingServiceUtil.SCRIPT_TYPE_ATTRIBUTE) ===
                    BlockingServiceUtil.SCRIPT_BLOCKING_TYPE_ATTRIBUTE_VALUE)
                    event.preventDefault();
                scriptNode.removeEventListener('beforescriptexecute', beforeScriptExecuteListener);
            };
            scriptNode.addEventListener('beforescriptexecute', beforeScriptExecuteListener);
        };
        BlockingService.iframeMutationObserver = function (iframeNode) {
            var src = iframeNode.src;
            var msftConsentCategories = iframeNode.getAttribute(BlockingServiceUtil.MSFT_CONSENT_CATEGORIES_ATTRIBUTE);
            if (BlockingServiceUtil.shouldIFrameConsented(msftConsentCategories)) {
                iframeNode.removeAttribute(BlockingServiceUtil.SRC_ATTRIBUTE);
                iframeNode.setAttribute(BlockingServiceUtil.DATASET_SRC_ATTRIBUTE, src);
            }
        };
        BlockingService.unblock = function () {
            window.__MSFT_SDK.Logger.info('Tracker Blocking unblock is started');
            BlockingService.unblockScripts();
            BlockingService.unblockIFrames();
        };
        BlockingService.unblockScripts = function () {
            document
                .querySelectorAll("script[".concat(BlockingServiceUtil.MSFT_CONSENT_CATEGORIES_ATTRIBUTE, "][").concat(BlockingServiceUtil.SCRIPT_TYPE_ATTRIBUTE, "=\"").concat(BlockingServiceUtil.SCRIPT_BLOCKING_TYPE_ATTRIBUTE_VALUE, "\"]:not([").concat(BlockingServiceUtil.MSFT_CONSENT_CATEGORIES_ATTRIBUTE, "=\"\"])"))
                .forEach(function (blockedNode) {
                var scriptNode = blockedNode;
                try {
                    var consentCategories = scriptNode.getAttribute(BlockingServiceUtil.MSFT_CONSENT_CATEGORIES_ATTRIBUTE);
                    var notConsentedCategories = consentCategories === null || consentCategories === void 0 ? void 0 : consentCategories.split(',').filter(function (x) {
                        var _a;
                        return !(((_a = window.__MSFT_SDK.Store.getters.userConsent) === null || _a === void 0 ? void 0 : _a.preferences[x]) === Preference.ON);
                    });
                    if (notConsentedCategories == null ||
                        notConsentedCategories.length === 0) {
                        var typeValue = scriptNode.getAttribute(BlockingServiceUtil.MSFT_POST_CONSENT_SCRIPT_TYPE_ATTRIBUTE);
                        typeValue =
                            typeValue != null ? typeValue : 'application/javascript';
                        var parentNode = scriptNode.parentNode;
                        parentNode === null || parentNode === void 0 ? void 0 : parentNode.removeChild(scriptNode);
                        var newNode = document.createElement('script');
                        for (var i = 0; i < scriptNode.attributes.length; i++) {
                            var attribute = scriptNode.attributes[i];
                            if (attribute.name !== 'type') {
                                newNode.setAttribute(attribute.name, scriptNode.attributes[i].value);
                            }
                            else {
                                newNode.setAttribute(BlockingServiceUtil.SCRIPT_TYPE_ATTRIBUTE, typeValue);
                            }
                        }
                        newNode.appendChild(document.createTextNode(scriptNode.innerHTML));
                        parentNode == null
                            ? document.head.appendChild(newNode)
                            : parentNode.appendChild(newNode);
                    }
                    else {
                        window.__MSFT_SDK.Logger.info('Failed to unblock script ' +
                            scriptNode.src +
                            'not consented for categories ' +
                            (notConsentedCategories === null || notConsentedCategories === void 0 ? void 0 : notConsentedCategories.toString()));
                    }
                }
                catch (error) {
                    // eslint-disable-next-line
                    console.warn('Failed to unblock the script ', scriptNode.src, 'with error ', error);
                    window.__MSFT_SDK.Logger.error('Failed to unblock script ' + scriptNode.src);
                }
            });
        };
        BlockingService.unblockIFrames = function () {
            document
                .querySelectorAll("iframe[".concat(BlockingServiceUtil.MSFT_CONSENT_CATEGORIES_ATTRIBUTE, "][").concat(BlockingServiceUtil.DATASET_SRC_ATTRIBUTE, "]:not([").concat(BlockingServiceUtil.MSFT_CONSENT_CATEGORIES_ATTRIBUTE, "=\"\"][").concat(BlockingServiceUtil.DATASET_SRC_ATTRIBUTE, "=\"\"])"))
                .forEach(function (blockedNode) {
                var iframeNode = blockedNode;
                try {
                    var consentCategories = iframeNode.getAttribute(BlockingServiceUtil.MSFT_CONSENT_CATEGORIES_ATTRIBUTE);
                    var notConsentedCategories = consentCategories === null || consentCategories === void 0 ? void 0 : consentCategories.split(',').filter(function (x) {
                        var _a;
                        return !(((_a = window.__MSFT_SDK.Store.getters.userConsent) === null || _a === void 0 ? void 0 : _a.preferences[x]) === Preference.ON);
                    });
                    if (notConsentedCategories == null ||
                        notConsentedCategories.length === 0) {
                        var parentNode = iframeNode.parentNode;
                        parentNode === null || parentNode === void 0 ? void 0 : parentNode.removeChild(iframeNode);
                        var newNode = iframeNode.cloneNode(true);
                        var datasrc = newNode.getAttribute(BlockingServiceUtil.DATASET_SRC_ATTRIBUTE);
                        datasrc = datasrc !== null ? datasrc : '';
                        newNode.setAttribute(BlockingServiceUtil.SRC_ATTRIBUTE, datasrc);
                        newNode.removeAttribute(BlockingServiceUtil.DATASET_SRC_ATTRIBUTE);
                        parentNode == null
                            ? document.head.appendChild(newNode)
                            : parentNode.appendChild(newNode);
                    }
                    else {
                        window.__MSFT_SDK.Logger.info('Failed to unblock iframe ' +
                            iframeNode.src +
                            'not consented for categories ' +
                            (notConsentedCategories === null || notConsentedCategories === void 0 ? void 0 : notConsentedCategories.toString()));
                    }
                }
                catch (error) {
                    // eslint-disable-next-line
                    console.warn('Failed to unblock the iframe ', iframeNode.src, 'with error ', error);
                    window.__MSFT_SDK.Logger.error('Failed to unblock iFrame ' + iframeNode.src);
                }
            });
        };
        return BlockingService;
    }());
    var BlockingServiceInstance = new BlockingService(true);

    var PublicAPI = /** @class */ (function () {
        function PublicAPI() {
        }
        //Public API
        PublicAPI.getBlockingService = function () {
            return BlockingServiceInstance;
        };
        return PublicAPI;
    }());

    window.__MSFT_SDK.Helpers.AddPublicApis(PublicAPI);
    window.__MSFT_SDK.Helpers.exposeApis();

}());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhY2tlckJsb2NraW5nLm1pbi5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vU0RLL3NyYy9jb3JlL2NvbnN0YW50cy9lbnVtcy50cyIsIi4uLy4uLy4uLy4uLy4uL1NESy9zcmMvdHJhY2tlckJsb2NraW5nL0Jsb2NraW5nU2VydmljZVV0aWwudHMiLCIuLi8uLi8uLi8uLi8uLi9TREsvc3JjL3RyYWNrZXJCbG9ja2luZy9CbG9ja2luZ1NlcnZpY2UudHMiLCIuLi8uLi8uLi8uLi8uLi9TREsvc3JjL3RyYWNrZXJCbG9ja2luZy9wdWJsaWNBcGkvaW5kZXgudHMiLCIuLi8uLi8uLi8uLi8uLi9TREsvc3JjL3RyYWNrZXJCbG9ja2luZy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZW51bSBDb25zZW50TW9kZWxUeXBlIHtcclxuICBFeHBsaWNpdCA9ICdFeHBsaWNpdCcsXHJcbiAgSW1wbGljaXQgPSAnSW1wbGljaXQnLFxyXG59XHJcblxyXG5leHBvcnQgZW51bSBQdWJsaWNFdmVudHMge1xyXG4gIENvbnNlbnRDaGFuZ2VkID0gJ0NvbnNlbnRDaGFuZ2VkJyxcclxuICBTaG93Q29uc2VudE5vdGljZSA9ICdTaG93Q29uc2VudE5vdGljZScsXHJcbiAgU2hvd0ZpcnN0UGFnZSA9ICdTaG93Rmlyc3RQYWdlJyxcclxuICBDbG9zZUNvbnNlbnROb3RpY2UgPSAnQ2xvc2VDb25zZW50Tm90aWNlJyxcclxuICBBY2NlcHRBbGwgPSAnQWNjZXB0QWxsJyxcclxuICBSZWplY3RBbGwgPSAnUmVqZWN0QWxsJyxcclxuICBTaG93VGVtcGxhdGUgPSAnU2hvd1RlbXBsYXRlJyxcclxuICBDbG9zZVRlbXBsYXRlID0gJ0Nsb3NlVGVtcGxhdGUnLFxyXG4gIFVwZGF0ZUNvbnNlbnQgPSAnVXBkYXRlQ29uc2VudCcsXHJcbiAgQW5jaG9yVGFnQ2xpY2tlZCA9ICdBbmNob3JUYWdDbGlja2VkJyxcclxuICBGZXRjaENvbmZpZyA9ICdGZXRjaENvbmZpZycsXHJcbiAgUXVlc3Rpb25zRm9ybVN1Ym1pdFdpdGhvdXRNZXRhRGF0YSA9ICdRdWVzdGlvbnNGb3JtU3VibWl0V2l0aG91dE1ldGFEYXRhJyxcclxuICBRdWVzdGlvbnNGb3JtU3VibWl0ID0gJ1F1ZXN0aW9uc0Zvcm1TdWJtaXQnLFxyXG4gIFNob3dQcmVmZXJlbmNlcyA9ICdTaG93UHJlZmVyZW5jZXMnLFxyXG59XHJcblxyXG5leHBvcnQgZW51bSBFdmVudHMge1xyXG4gIEluaXQgPSAnSW5pdCcsXHJcbiAgQ29yZUNvbnNlbnRNb2RlbFNlbGVjdGVkID0gJ0NvcmVDb25zZW50TW9kZWxTZWxlY3RlZCcsXHJcbiAgQ29uZmlnUmVhZHkgPSAnQ29uZmlnUmVhZHknLFxyXG59XHJcblxyXG5leHBvcnQgZW51bSBTREtNb2RlIHtcclxuICBEZWZhdWx0ID0gJ0RlZmF1bHQnLFxyXG4gIEhlYWRMZXNzID0gJ0hlYWRMZXNzJyxcclxufVxyXG5cclxuZXhwb3J0IGVudW0gU3R5bGVUeXBlIHtcclxuICBVcmwgPSAnVXJsJyxcclxuICBUZXh0ID0gJ1RleHQnLFxyXG59XHJcblxyXG5leHBvcnQgZW51bSBQcmVmZXJlbmNlIHtcclxuICBPRkYgPSAnMCcsXHJcbiAgT04gPSAnMScsXHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIENvb2tpZSB7XHJcbiAgQ29uc2VudCA9ICdtc2Z0LWNvbnNlbnQnLFxyXG59XHJcblxyXG5leHBvcnQgZW51bSBSZWdpc3RlcmVkRGl2VHlwZSB7XHJcbiAgU2NyaXB0ID0gJ3NjcmlwdCcsXHJcbiAgSUZyYW1lID0gJ2lmcmFtZScsXHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIE5vdGljZVR5cGUge1xyXG4gIFRyYWNrZXJDYXRlZ29yeSA9ICd0cmFja2VyQ2F0ZWdvcnknLFxyXG59XHJcblxyXG5leHBvcnQgZW51bSBFcnJvclN0cmluZ3Mge1xyXG4gIFRlbXBsYXRlRXJyb3IgPSAnPGI+VGhlcmUgaXMgc29tZXRoaW5nIHdyb25nIHdpdGggdGVtcGxhdGUuIFBsZWFzZSBjaGVjayBsb2dzLjwvYj4nLFxyXG59XHJcblxyXG5leHBvcnQgZW51bSBJbnRlcnZhbFVuaXRzIHtcclxuICBkYXkgPSAnZGF5JyxcclxuICB3ZWVrID0gJ3dlZWsnLFxyXG4gIG1vbnRoID0gJ21vbnRoJyxcclxuICB5ZWFyID0gJ3llYXInLFxyXG59XHJcblxyXG5leHBvcnQgZW51bSBRdWVzdGlvblR5cGUge1xyXG4gIFRleHQgPSAnVGV4dCcsXHJcbiAgRW1haWwgPSAnRW1haWwnLFxyXG4gIFJhZGlvID0gJ1JhZGlvJyxcclxuICBNdWx0aVNlbGVjdCA9ICdNdWx0aVNlbGVjdCcsXHJcbiAgU2VsZWN0ID0gJ1NlbGVjdCcsXHJcbiAgRGF0ZSA9ICdEYXRlJyxcclxuICBQaG9uZU51bWJlciA9ICdQaG9uZU51bWJlcicsXHJcbiAgQ3JlZGl0Q2FyZCA9ICdDcmVkaXRDYXJkJyxcclxuICBOdW1iZXIgPSAnTnVtYmVyJyxcclxuICBNdWx0aUxpbmVUZXh0ID0gJ211bHRpTGluZVRleHQnLFxyXG59XHJcblxyXG5leHBvcnQgZW51bSBRdWVzdGlvblZhbGlkYXRpb24ge1xyXG4gIFJlcXVpcmVkID0gJ3JlcXVpcmVkJyxcclxufVxyXG5cclxuZXhwb3J0IGVudW0gUXVlc3Rpb25GaWVsZCB7XHJcbiAgUXVlc3Rpb24gPSAncXVlc3Rpb24nLFxyXG4gIFBsYWNlaG9sZGVyID0gJ3BsYWNlaG9sZGVyJyxcclxuICBPcHRpb25zID0gJ29wdGlvbnMnLFxyXG59XHJcblxyXG5leHBvcnQgZW51bSBNb2RlbEtpbmQge1xyXG4gIFdlYkNvbnNlbnRNb2RlbCA9ICdXZWJDb25zZW50TW9kZWwnLFxyXG4gIFF1ZXN0aW9uTW9kZWwgPSAnRFNSU3VibWlzc2lvbk1vZGVsJyxcclxufVxyXG5cclxuZXhwb3J0IGVudW0gVGVtcGxhdGUge1xyXG4gIFByZWZlcmVuY2VzID0gJ1ByZWZlcmVuY2VzJyxcclxufVxyXG4iLCJpbXBvcnQgeyBQcmVmZXJlbmNlIH0gZnJvbSAnY29yZS9jb25zdGFudHMvZW51bXMnO1xyXG5cclxuZXhwb3J0IGNsYXNzIEJsb2NraW5nU2VydmljZVV0aWwge1xyXG4gIHN0YXRpYyBTQ1JJUFRfQkxPQ0tJTkdfVFlQRV9BVFRSSUJVVEVfVkFMVUUgPSAndGV4dC9ibG9ja2VkJztcclxuICBzdGF0aWMgTVNGVF9DT05TRU5UX0NBVEVHT1JJRVNfQVRUUklCVVRFID0gJ21zZnQtY29uc2VudC1jYXRlZ29yaWVzJztcclxuICBzdGF0aWMgU1JDX0FUVFJJQlVURSA9ICdzcmMnO1xyXG4gIHN0YXRpYyBEQVRBU0VUX1NSQ19BVFRSSUJVVEUgPSAnZGF0YS1zcmMnO1xyXG4gIHN0YXRpYyBTQ1JJUFRfVFlQRV9BVFRSSUJVVEUgPSAndHlwZSc7XHJcbiAgc3RhdGljIE1TRlRfUE9TVF9DT05TRU5UX1NDUklQVF9UWVBFX0FUVFJJQlVURSA9ICdtc2Z0LXBvc3QtY29uc2VudC10eXBlJztcclxuICBzdGF0aWMgTVNGVF9DT05TRU5UX0lHTk9SRV9BVFRSSUJVVEUgPSAnbXNmdC1pZ25vcmUtY29uc2VudCc7XHJcblxyXG4gIHN0YXRpYyBzaG91bGRTY3JpcHRDb25zZW50ZWQoY2F0ZWdvcmllczogc3RyaW5nIHwgbnVsbCk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKGNhdGVnb3JpZXMgIT09IG51bGwgJiYgY2F0ZWdvcmllcy5zcGxpdCgnLCcpLmxlbmd0aCA+IDApIHtcclxuICAgICAgcmV0dXJuIHRoaXMuY29uc2VudENhdGVnb3JpZXNQZW5kaW5nKGNhdGVnb3JpZXMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHNob3VsZElGcmFtZUNvbnNlbnRlZChjYXRlZ29yaWVzOiBzdHJpbmcgfCBudWxsKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoY2F0ZWdvcmllcyAhPT0gbnVsbCAmJiBjYXRlZ29yaWVzLnNwbGl0KCcsJykubGVuZ3RoID4gMCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5jb25zZW50Q2F0ZWdvcmllc1BlbmRpbmcoY2F0ZWdvcmllcyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgY29uc2VudENhdGVnb3JpZXNQZW5kaW5nKGNhdGVnb3JpZXM6IHN0cmluZyB8IG51bGwpOiBib29sZWFuIHtcclxuICAgIGlmIChjYXRlZ29yaWVzICE9IG51bGwpIHtcclxuICAgICAgY29uc3QgcGVuZGluZ0NvbnNlbnQgPSBjYXRlZ29yaWVzXHJcbiAgICAgICAgLnNwbGl0KCcsJylcclxuICAgICAgICAuZmlsdGVyKFxyXG4gICAgICAgICAgeCA9PlxyXG4gICAgICAgICAgICAhKFxyXG4gICAgICAgICAgICAgIHdpbmRvdy5fX01TRlRfU0RLLlN0b3JlLmdldHRlcnMudXNlckNvbnNlbnQ/LnByZWZlcmVuY2VzW3hdID09PVxyXG4gICAgICAgICAgICAgIFByZWZlcmVuY2UuT05cclxuICAgICAgICAgICAgKSxcclxuICAgICAgICApO1xyXG4gICAgICByZXR1cm4gcGVuZGluZ0NvbnNlbnQgIT0gbnVsbCAmJiBwZW5kaW5nQ29uc2VudC5sZW5ndGggPiAwO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHNob3VsZGJlVW5ibG9ja2VkKG1zZnRDb25zZW50Q2F0ZWdvcmllczogc3RyaW5nIHwgbnVsbCkge1xyXG4gICAgaWYgKG1zZnRDb25zZW50Q2F0ZWdvcmllcyAhPSBudWxsKSB7XHJcbiAgICAgIGNvbnN0IHBlbmRpbmdDb25zZW50ID0gbXNmdENvbnNlbnRDYXRlZ29yaWVzXHJcbiAgICAgICAgLnNwbGl0KCcsJylcclxuICAgICAgICAuZmlsdGVyKFxyXG4gICAgICAgICAgeCA9PlxyXG4gICAgICAgICAgICAhKFxyXG4gICAgICAgICAgICAgIHdpbmRvdy5fX01TRlRfU0RLLlN0b3JlLmdldHRlcnMudXNlckNvbnNlbnQ/LnByZWZlcmVuY2VzW3hdID09PVxyXG4gICAgICAgICAgICAgIFByZWZlcmVuY2UuT05cclxuICAgICAgICAgICAgKSxcclxuICAgICAgICApO1xyXG4gICAgICByZXR1cm4gcGVuZGluZ0NvbnNlbnQgPT0gbnVsbCB8fCBwZW5kaW5nQ29uc2VudC5sZW5ndGggPT0gMDtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHNob3VsZFNjcmlwdFVuYmxvY2tlZChcclxuICAgIHR5cGU6IHN0cmluZyB8IG51bGwsXHJcbiAgICBtc2Z0Q29uc2VudENhdGVnb3JpZXM6IHN0cmluZyB8IG51bGwsXHJcbiAgKTogYm9vbGVhbiB7XHJcbiAgICBpZiAodHlwZSAhPT0gbnVsbCAmJiB0eXBlID09PSB0aGlzLlNDUklQVF9CTE9DS0lOR19UWVBFX0FUVFJJQlVURV9WQUxVRSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5zaG91bGRiZVVuYmxvY2tlZChtc2Z0Q29uc2VudENhdGVnb3JpZXMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHNob3VsZElGcmFtZVVuYmxvY2tlZChcclxuICAgIGRhdGFTcmM6IHN0cmluZyB8IG51bGwsXHJcbiAgICBtc2Z0Q29uc2VudENhdGVnb3JpZXM6IHN0cmluZyB8IG51bGwsXHJcbiAgKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoZGF0YVNyYyAhPT0gbnVsbCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5zaG91bGRiZVVuYmxvY2tlZChtc2Z0Q29uc2VudENhdGVnb3JpZXMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBQcmVmZXJlbmNlIH0gZnJvbSAnY29yZS9jb25zdGFudHMvZW51bXMnO1xyXG5pbXBvcnQgeyBCbG9ja2luZ1NlcnZpY2VVdGlsIH0gZnJvbSAnLi9CbG9ja2luZ1NlcnZpY2VVdGlsJztcclxuXHJcbmV4cG9ydCBjbGFzcyBCbG9ja2luZ1NlcnZpY2Uge1xyXG4gIHByaXZhdGUgZG9tT2JzZXJ2ZXI6IE11dGF0aW9uT2JzZXJ2ZXIgfCBudWxsO1xyXG5cclxuICBjb25zdHJ1Y3RvcihlbmFibGVNdXRhdGlvbk9ic2VydmVyOiBib29sZWFuKSB7XHJcbiAgICB3aW5kb3cuX19NU0ZUX1NESy5FdmVudEJ1cy5vbihcclxuICAgICAgd2luZG93Ll9fTVNGVF9TREsuZW51bXMuUHVibGljRXZlbnRzLkNvbnNlbnRDaGFuZ2VkLFxyXG4gICAgICBCbG9ja2luZ1NlcnZpY2UudW5ibG9jayxcclxuICAgICk7XHJcbiAgICB0aGlzLmRvbU9ic2VydmVyID0gbnVsbDtcclxuICAgIGlmIChlbmFibGVNdXRhdGlvbk9ic2VydmVyKSB7XHJcbiAgICAgIHRoaXMuZG9tT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihcclxuICAgICAgICAobXV0YXRpb25SZWNvcmRzOiBNdXRhdGlvblJlY29yZFtdKSA9PlxyXG4gICAgICAgICAgQmxvY2tpbmdTZXJ2aWNlLm11dGF0aW9uQ2FsbGJhY2sobXV0YXRpb25SZWNvcmRzKSxcclxuICAgICAgKTtcclxuICAgICAgdGhpcy5kb21PYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwge1xyXG4gICAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcclxuICAgICAgICBzdWJ0cmVlOiB0cnVlLFxyXG4gICAgICB9KTtcclxuICAgICAgd2luZG93Ll9fTVNGVF9TREsuTG9nZ2VyLmluZm8oJ1N0YXJ0ZWQgdHJhY2tlciBibG9ja2luZyBzZXJ2aWNlJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyBtdXRhdGlvbkNhbGxiYWNrKG11dGF0aW9uUmVjb3JkczogTXV0YXRpb25SZWNvcmRbXSk6IHZvaWQge1xyXG4gICAgbXV0YXRpb25SZWNvcmRzLmZvckVhY2gobXV0YXRpb25SZWNvcmQgPT4ge1xyXG4gICAgICBtdXRhdGlvblJlY29yZC5hZGRlZE5vZGVzLmZvckVhY2goYWRkZWROb2RlID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICBhZGRlZE5vZGUubm9kZVR5cGUgPT09IDEgJiZcclxuICAgICAgICAgICAgKDxIVE1MRWxlbWVudD5hZGRlZE5vZGUpLmhhc0F0dHJpYnV0ZShcclxuICAgICAgICAgICAgICBCbG9ja2luZ1NlcnZpY2VVdGlsLk1TRlRfQ09OU0VOVF9JR05PUkVfQVRUUklCVVRFLFxyXG4gICAgICAgICAgICApID09PSBmYWxzZVxyXG4gICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICBhZGRlZE5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT1cclxuICAgICAgICAgICAgICB3aW5kb3cuX19NU0ZUX1NESy5lbnVtcy5SZWdpc3RlcmVkRGl2VHlwZS5TY3JpcHRcclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgQmxvY2tpbmdTZXJ2aWNlLnNjcmlwdE11dGF0aW9uT2JzZXJ2ZXIoXHJcbiAgICAgICAgICAgICAgICA8SFRNTFNjcmlwdEVsZW1lbnQ+YWRkZWROb2RlLFxyXG4gICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoXHJcbiAgICAgICAgICAgICAgYWRkZWROb2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09XHJcbiAgICAgICAgICAgICAgd2luZG93Ll9fTVNGVF9TREsuZW51bXMuUmVnaXN0ZXJlZERpdlR5cGUuSUZyYW1lXHJcbiAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgIEJsb2NraW5nU2VydmljZS5pZnJhbWVNdXRhdGlvbk9ic2VydmVyKFxyXG4gICAgICAgICAgICAgICAgPEhUTUxJRnJhbWVFbGVtZW50PmFkZGVkTm9kZSxcclxuICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUud2FybihcclxuICAgICAgICAgICAgJ0ZhaWxlZCB0byBibG9jayB0aGUgbm9kZSAnLFxyXG4gICAgICAgICAgICBhZGRlZE5vZGUubm9kZU5hbWUsXHJcbiAgICAgICAgICAgICd3aXRoIGVycm9yICcsXHJcbiAgICAgICAgICAgIGVycm9yLFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIHdpbmRvdy5fX01TRlRfU0RLLkxvZ2dlci53YXJuKFxyXG4gICAgICAgICAgICAnRmFpbGVkIHRvIGJsb2NrIHRhZyAnICsgYWRkZWROb2RlLm5vZGVOYW1lLFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyBzY3JpcHRNdXRhdGlvbk9ic2VydmVyKHNjcmlwdE5vZGU6IEhUTUxTY3JpcHRFbGVtZW50KTogdm9pZCB7XHJcbiAgICBjb25zdCB0eXBlID0gc2NyaXB0Tm9kZS50eXBlO1xyXG4gICAgY29uc3QgbXNmdENvbnNlbnRDYXRlZ29yaWVzID0gc2NyaXB0Tm9kZS5nZXRBdHRyaWJ1dGUoXHJcbiAgICAgIEJsb2NraW5nU2VydmljZVV0aWwuTVNGVF9DT05TRU5UX0NBVEVHT1JJRVNfQVRUUklCVVRFLFxyXG4gICAgKTtcclxuICAgIGlmIChCbG9ja2luZ1NlcnZpY2VVdGlsLnNob3VsZFNjcmlwdENvbnNlbnRlZChtc2Z0Q29uc2VudENhdGVnb3JpZXMpKSB7XHJcbiAgICAgIHNjcmlwdE5vZGUuc2V0QXR0cmlidXRlKFxyXG4gICAgICAgIEJsb2NraW5nU2VydmljZVV0aWwuTVNGVF9QT1NUX0NPTlNFTlRfU0NSSVBUX1RZUEVfQVRUUklCVVRFLFxyXG4gICAgICAgIHR5cGUsXHJcbiAgICAgICk7XHJcbiAgICAgIHNjcmlwdE5vZGUuc2V0QXR0cmlidXRlKFxyXG4gICAgICAgIEJsb2NraW5nU2VydmljZVV0aWwuU0NSSVBUX1RZUEVfQVRUUklCVVRFLFxyXG4gICAgICAgIEJsb2NraW5nU2VydmljZVV0aWwuU0NSSVBUX0JMT0NLSU5HX1RZUEVfQVRUUklCVVRFX1ZBTFVFLFxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZpcmVmb3ggaGFzIHRoaXMgYWRkaXRpb25hbCBldmVudCB3aGljaCBwcmV2ZW50cyBzY3JpcHRzIGZyb20gYmVpbmcgZXhlY3V0ZWRcclxuICAgIGNvbnN0IGJlZm9yZVNjcmlwdEV4ZWN1dGVMaXN0ZW5lciA9IGZ1bmN0aW9uIChldmVudDogYW55KSB7XHJcbiAgICAgIC8vIFByZXZlbnQgb25seSBtYXJrZWQgc2NyaXB0cyBmcm9tIGV4ZWN1dGluZ1xyXG4gICAgICBpZiAoXHJcbiAgICAgICAgc2NyaXB0Tm9kZS5nZXRBdHRyaWJ1dGUoQmxvY2tpbmdTZXJ2aWNlVXRpbC5TQ1JJUFRfVFlQRV9BVFRSSUJVVEUpID09PVxyXG4gICAgICAgIEJsb2NraW5nU2VydmljZVV0aWwuU0NSSVBUX0JMT0NLSU5HX1RZUEVfQVRUUklCVVRFX1ZBTFVFXHJcbiAgICAgIClcclxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBzY3JpcHROb2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoXHJcbiAgICAgICAgJ2JlZm9yZXNjcmlwdGV4ZWN1dGUnLFxyXG4gICAgICAgIGJlZm9yZVNjcmlwdEV4ZWN1dGVMaXN0ZW5lcixcclxuICAgICAgKTtcclxuICAgIH07XHJcbiAgICBzY3JpcHROb2RlLmFkZEV2ZW50TGlzdGVuZXIoXHJcbiAgICAgICdiZWZvcmVzY3JpcHRleGVjdXRlJyxcclxuICAgICAgYmVmb3JlU2NyaXB0RXhlY3V0ZUxpc3RlbmVyLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIGlmcmFtZU11dGF0aW9uT2JzZXJ2ZXIoaWZyYW1lTm9kZTogSFRNTElGcmFtZUVsZW1lbnQpOiB2b2lkIHtcclxuICAgIGNvbnN0IHNyYyA9IGlmcmFtZU5vZGUuc3JjO1xyXG4gICAgY29uc3QgbXNmdENvbnNlbnRDYXRlZ29yaWVzID0gaWZyYW1lTm9kZS5nZXRBdHRyaWJ1dGUoXHJcbiAgICAgIEJsb2NraW5nU2VydmljZVV0aWwuTVNGVF9DT05TRU5UX0NBVEVHT1JJRVNfQVRUUklCVVRFLFxyXG4gICAgKTtcclxuICAgIGlmIChCbG9ja2luZ1NlcnZpY2VVdGlsLnNob3VsZElGcmFtZUNvbnNlbnRlZChtc2Z0Q29uc2VudENhdGVnb3JpZXMpKSB7XHJcbiAgICAgIGlmcmFtZU5vZGUucmVtb3ZlQXR0cmlidXRlKEJsb2NraW5nU2VydmljZVV0aWwuU1JDX0FUVFJJQlVURSk7XHJcbiAgICAgIGlmcmFtZU5vZGUuc2V0QXR0cmlidXRlKEJsb2NraW5nU2VydmljZVV0aWwuREFUQVNFVF9TUkNfQVRUUklCVVRFLCBzcmMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzdGF0aWMgdW5ibG9jaygpOiB2b2lkIHtcclxuICAgIHdpbmRvdy5fX01TRlRfU0RLLkxvZ2dlci5pbmZvKCdUcmFja2VyIEJsb2NraW5nIHVuYmxvY2sgaXMgc3RhcnRlZCcpO1xyXG4gICAgQmxvY2tpbmdTZXJ2aWNlLnVuYmxvY2tTY3JpcHRzKCk7XHJcbiAgICBCbG9ja2luZ1NlcnZpY2UudW5ibG9ja0lGcmFtZXMoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIHVuYmxvY2tTY3JpcHRzKCk6IHZvaWQge1xyXG4gICAgZG9jdW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXHJcbiAgICAgICAgYHNjcmlwdFske0Jsb2NraW5nU2VydmljZVV0aWwuTVNGVF9DT05TRU5UX0NBVEVHT1JJRVNfQVRUUklCVVRFfV1bJHtCbG9ja2luZ1NlcnZpY2VVdGlsLlNDUklQVF9UWVBFX0FUVFJJQlVURX09XCIke0Jsb2NraW5nU2VydmljZVV0aWwuU0NSSVBUX0JMT0NLSU5HX1RZUEVfQVRUUklCVVRFX1ZBTFVFfVwiXTpub3QoWyR7QmxvY2tpbmdTZXJ2aWNlVXRpbC5NU0ZUX0NPTlNFTlRfQ0FURUdPUklFU19BVFRSSUJVVEV9PVwiXCJdKWAsXHJcbiAgICAgIClcclxuICAgICAgLmZvckVhY2goYmxvY2tlZE5vZGUgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNjcmlwdE5vZGUgPSA8SFRNTFNjcmlwdEVsZW1lbnQ+YmxvY2tlZE5vZGU7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGNvbnN0IGNvbnNlbnRDYXRlZ29yaWVzID0gc2NyaXB0Tm9kZS5nZXRBdHRyaWJ1dGUoXHJcbiAgICAgICAgICAgIEJsb2NraW5nU2VydmljZVV0aWwuTVNGVF9DT05TRU5UX0NBVEVHT1JJRVNfQVRUUklCVVRFLFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIGNvbnN0IG5vdENvbnNlbnRlZENhdGVnb3JpZXMgPSBjb25zZW50Q2F0ZWdvcmllc1xyXG4gICAgICAgICAgICA/LnNwbGl0KCcsJylcclxuICAgICAgICAgICAgLmZpbHRlcihcclxuICAgICAgICAgICAgICB4ID0+XHJcbiAgICAgICAgICAgICAgICAhKFxyXG4gICAgICAgICAgICAgICAgICB3aW5kb3cuX19NU0ZUX1NESy5TdG9yZS5nZXR0ZXJzLnVzZXJDb25zZW50Py5wcmVmZXJlbmNlc1tcclxuICAgICAgICAgICAgICAgICAgICB4XHJcbiAgICAgICAgICAgICAgICAgIF0gPT09IFByZWZlcmVuY2UuT05cclxuICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIG5vdENvbnNlbnRlZENhdGVnb3JpZXMgPT0gbnVsbCB8fFxyXG4gICAgICAgICAgICBub3RDb25zZW50ZWRDYXRlZ29yaWVzLmxlbmd0aCA9PT0gMFxyXG4gICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIGxldCB0eXBlVmFsdWUgPSBzY3JpcHROb2RlLmdldEF0dHJpYnV0ZShcclxuICAgICAgICAgICAgICBCbG9ja2luZ1NlcnZpY2VVdGlsLk1TRlRfUE9TVF9DT05TRU5UX1NDUklQVF9UWVBFX0FUVFJJQlVURSxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgdHlwZVZhbHVlID1cclxuICAgICAgICAgICAgICB0eXBlVmFsdWUgIT0gbnVsbCA/IHR5cGVWYWx1ZSA6ICdhcHBsaWNhdGlvbi9qYXZhc2NyaXB0JztcclxuICAgICAgICAgICAgY29uc3QgcGFyZW50Tm9kZSA9IHNjcmlwdE5vZGUucGFyZW50Tm9kZTtcclxuICAgICAgICAgICAgcGFyZW50Tm9kZT8ucmVtb3ZlQ2hpbGQoc2NyaXB0Tm9kZSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBuZXdOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2NyaXB0Tm9kZS5hdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlID0gc2NyaXB0Tm9kZS5hdHRyaWJ1dGVzW2ldO1xyXG4gICAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUubmFtZSAhPT0gJ3R5cGUnKSB7XHJcbiAgICAgICAgICAgICAgICBuZXdOb2RlLnNldEF0dHJpYnV0ZShcclxuICAgICAgICAgICAgICAgICAgYXR0cmlidXRlLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgIHNjcmlwdE5vZGUuYXR0cmlidXRlc1tpXS52YWx1ZSxcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG5ld05vZGUuc2V0QXR0cmlidXRlKFxyXG4gICAgICAgICAgICAgICAgICBCbG9ja2luZ1NlcnZpY2VVdGlsLlNDUklQVF9UWVBFX0FUVFJJQlVURSxcclxuICAgICAgICAgICAgICAgICAgdHlwZVZhbHVlLFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbmV3Tm9kZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShzY3JpcHROb2RlLmlubmVySFRNTCkpO1xyXG4gICAgICAgICAgICBwYXJlbnROb2RlID09IG51bGxcclxuICAgICAgICAgICAgICA/IGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQobmV3Tm9kZSlcclxuICAgICAgICAgICAgICA6IHBhcmVudE5vZGUuYXBwZW5kQ2hpbGQobmV3Tm9kZSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB3aW5kb3cuX19NU0ZUX1NESy5Mb2dnZXIuaW5mbyhcclxuICAgICAgICAgICAgICAnRmFpbGVkIHRvIHVuYmxvY2sgc2NyaXB0ICcgK1xyXG4gICAgICAgICAgICAgICAgc2NyaXB0Tm9kZS5zcmMgK1xyXG4gICAgICAgICAgICAgICAgJ25vdCBjb25zZW50ZWQgZm9yIGNhdGVnb3JpZXMgJyArXHJcbiAgICAgICAgICAgICAgICBub3RDb25zZW50ZWRDYXRlZ29yaWVzPy50b1N0cmluZygpLFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcclxuICAgICAgICAgIGNvbnNvbGUud2FybihcclxuICAgICAgICAgICAgJ0ZhaWxlZCB0byB1bmJsb2NrIHRoZSBzY3JpcHQgJyxcclxuICAgICAgICAgICAgc2NyaXB0Tm9kZS5zcmMsXHJcbiAgICAgICAgICAgICd3aXRoIGVycm9yICcsXHJcbiAgICAgICAgICAgIGVycm9yLFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIHdpbmRvdy5fX01TRlRfU0RLLkxvZ2dlci5lcnJvcihcclxuICAgICAgICAgICAgJ0ZhaWxlZCB0byB1bmJsb2NrIHNjcmlwdCAnICsgc2NyaXB0Tm9kZS5zcmMsXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyB1bmJsb2NrSUZyYW1lcygpOiB2b2lkIHtcclxuICAgIGRvY3VtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKFxyXG4gICAgICAgIGBpZnJhbWVbJHtCbG9ja2luZ1NlcnZpY2VVdGlsLk1TRlRfQ09OU0VOVF9DQVRFR09SSUVTX0FUVFJJQlVURX1dWyR7QmxvY2tpbmdTZXJ2aWNlVXRpbC5EQVRBU0VUX1NSQ19BVFRSSUJVVEV9XTpub3QoWyR7QmxvY2tpbmdTZXJ2aWNlVXRpbC5NU0ZUX0NPTlNFTlRfQ0FURUdPUklFU19BVFRSSUJVVEV9PVwiXCJdWyR7QmxvY2tpbmdTZXJ2aWNlVXRpbC5EQVRBU0VUX1NSQ19BVFRSSUJVVEV9PVwiXCJdKWAsXHJcbiAgICAgIClcclxuICAgICAgLmZvckVhY2goYmxvY2tlZE5vZGUgPT4ge1xyXG4gICAgICAgIGNvbnN0IGlmcmFtZU5vZGUgPSA8SFRNTElGcmFtZUVsZW1lbnQ+YmxvY2tlZE5vZGU7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGNvbnN0IGNvbnNlbnRDYXRlZ29yaWVzID0gaWZyYW1lTm9kZS5nZXRBdHRyaWJ1dGUoXHJcbiAgICAgICAgICAgIEJsb2NraW5nU2VydmljZVV0aWwuTVNGVF9DT05TRU5UX0NBVEVHT1JJRVNfQVRUUklCVVRFLFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIGNvbnN0IG5vdENvbnNlbnRlZENhdGVnb3JpZXMgPSBjb25zZW50Q2F0ZWdvcmllc1xyXG4gICAgICAgICAgICA/LnNwbGl0KCcsJylcclxuICAgICAgICAgICAgLmZpbHRlcihcclxuICAgICAgICAgICAgICB4ID0+XHJcbiAgICAgICAgICAgICAgICAhKFxyXG4gICAgICAgICAgICAgICAgICB3aW5kb3cuX19NU0ZUX1NESy5TdG9yZS5nZXR0ZXJzLnVzZXJDb25zZW50Py5wcmVmZXJlbmNlc1tcclxuICAgICAgICAgICAgICAgICAgICB4XHJcbiAgICAgICAgICAgICAgICAgIF0gPT09IFByZWZlcmVuY2UuT05cclxuICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIG5vdENvbnNlbnRlZENhdGVnb3JpZXMgPT0gbnVsbCB8fFxyXG4gICAgICAgICAgICBub3RDb25zZW50ZWRDYXRlZ29yaWVzLmxlbmd0aCA9PT0gMFxyXG4gICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudE5vZGUgPSBpZnJhbWVOb2RlLnBhcmVudE5vZGU7XHJcbiAgICAgICAgICAgIHBhcmVudE5vZGU/LnJlbW92ZUNoaWxkKGlmcmFtZU5vZGUpO1xyXG4gICAgICAgICAgICBjb25zdCBuZXdOb2RlID0gPEhUTUxJRnJhbWVFbGVtZW50PmlmcmFtZU5vZGUuY2xvbmVOb2RlKHRydWUpO1xyXG4gICAgICAgICAgICBsZXQgZGF0YXNyYyA9IG5ld05vZGUuZ2V0QXR0cmlidXRlKFxyXG4gICAgICAgICAgICAgIEJsb2NraW5nU2VydmljZVV0aWwuREFUQVNFVF9TUkNfQVRUUklCVVRFLFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBkYXRhc3JjID0gZGF0YXNyYyAhPT0gbnVsbCA/IGRhdGFzcmMgOiAnJztcclxuICAgICAgICAgICAgbmV3Tm9kZS5zZXRBdHRyaWJ1dGUoQmxvY2tpbmdTZXJ2aWNlVXRpbC5TUkNfQVRUUklCVVRFLCBkYXRhc3JjKTtcclxuICAgICAgICAgICAgbmV3Tm9kZS5yZW1vdmVBdHRyaWJ1dGUoQmxvY2tpbmdTZXJ2aWNlVXRpbC5EQVRBU0VUX1NSQ19BVFRSSUJVVEUpO1xyXG4gICAgICAgICAgICBwYXJlbnROb2RlID09IG51bGxcclxuICAgICAgICAgICAgICA/IGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQobmV3Tm9kZSlcclxuICAgICAgICAgICAgICA6IHBhcmVudE5vZGUuYXBwZW5kQ2hpbGQobmV3Tm9kZSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB3aW5kb3cuX19NU0ZUX1NESy5Mb2dnZXIuaW5mbyhcclxuICAgICAgICAgICAgICAnRmFpbGVkIHRvIHVuYmxvY2sgaWZyYW1lICcgK1xyXG4gICAgICAgICAgICAgICAgaWZyYW1lTm9kZS5zcmMgK1xyXG4gICAgICAgICAgICAgICAgJ25vdCBjb25zZW50ZWQgZm9yIGNhdGVnb3JpZXMgJyArXHJcbiAgICAgICAgICAgICAgICBub3RDb25zZW50ZWRDYXRlZ29yaWVzPy50b1N0cmluZygpLFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcclxuICAgICAgICAgIGNvbnNvbGUud2FybihcclxuICAgICAgICAgICAgJ0ZhaWxlZCB0byB1bmJsb2NrIHRoZSBpZnJhbWUgJyxcclxuICAgICAgICAgICAgaWZyYW1lTm9kZS5zcmMsXHJcbiAgICAgICAgICAgICd3aXRoIGVycm9yICcsXHJcbiAgICAgICAgICAgIGVycm9yLFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIHdpbmRvdy5fX01TRlRfU0RLLkxvZ2dlci5lcnJvcihcclxuICAgICAgICAgICAgJ0ZhaWxlZCB0byB1bmJsb2NrIGlGcmFtZSAnICsgaWZyYW1lTm9kZS5zcmMsXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgQmxvY2tpbmdTZXJ2aWNlSW5zdGFuY2UgPSBuZXcgQmxvY2tpbmdTZXJ2aWNlKHRydWUpO1xyXG4iLCJpbXBvcnQgeyBCbG9ja2luZ1NlcnZpY2VJbnN0YW5jZSwgQmxvY2tpbmdTZXJ2aWNlIH0gZnJvbSAnLi4vQmxvY2tpbmdTZXJ2aWNlJztcclxuXHJcbmV4cG9ydCBjbGFzcyBQdWJsaWNBUEkge1xyXG4gIC8vUHVibGljIEFQSVxyXG4gIHB1YmxpYyBzdGF0aWMgZ2V0QmxvY2tpbmdTZXJ2aWNlKCk6IEJsb2NraW5nU2VydmljZSB7XHJcbiAgICByZXR1cm4gQmxvY2tpbmdTZXJ2aWNlSW5zdGFuY2U7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IFB1YmxpY0FQSSB9IGZyb20gJy4vcHVibGljQXBpJztcclxud2luZG93Ll9fTVNGVF9TREsuSGVscGVycy5BZGRQdWJsaWNBcGlzKFB1YmxpY0FQSSk7XHJcbndpbmRvdy5fX01TRlRfU0RLLkhlbHBlcnMuZXhwb3NlQXBpcygpO1xyXG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0lBQUEsSUFBWSxnQkFHWDtJQUhELFdBQVksZ0JBQWdCO1FBQzFCLHlDQUFxQixDQUFBO1FBQ3JCLHlDQUFxQixDQUFBO0lBQ3ZCLENBQUMsRUFIVyxnQkFBZ0IsS0FBaEIsZ0JBQWdCLFFBRzNCO0lBRUQsSUFBWSxZQWVYO0lBZkQsV0FBWSxZQUFZO1FBQ3RCLGlEQUFpQyxDQUFBO1FBQ2pDLHVEQUF1QyxDQUFBO1FBQ3ZDLCtDQUErQixDQUFBO1FBQy9CLHlEQUF5QyxDQUFBO1FBQ3pDLHVDQUF1QixDQUFBO1FBQ3ZCLHVDQUF1QixDQUFBO1FBQ3ZCLDZDQUE2QixDQUFBO1FBQzdCLCtDQUErQixDQUFBO1FBQy9CLCtDQUErQixDQUFBO1FBQy9CLHFEQUFxQyxDQUFBO1FBQ3JDLDJDQUEyQixDQUFBO1FBQzNCLHlGQUF5RSxDQUFBO1FBQ3pFLDJEQUEyQyxDQUFBO1FBQzNDLG1EQUFtQyxDQUFBO0lBQ3JDLENBQUMsRUFmVyxZQUFZLEtBQVosWUFBWSxRQWV2QjtJQUVELElBQVksTUFJWDtJQUpELFdBQVksTUFBTTtRQUNoQix1QkFBYSxDQUFBO1FBQ2IsK0RBQXFELENBQUE7UUFDckQscUNBQTJCLENBQUE7SUFDN0IsQ0FBQyxFQUpXLE1BQU0sS0FBTixNQUFNLFFBSWpCO0lBRUQsSUFBWSxPQUdYO0lBSEQsV0FBWSxPQUFPO1FBQ2pCLDhCQUFtQixDQUFBO1FBQ25CLGdDQUFxQixDQUFBO0lBQ3ZCLENBQUMsRUFIVyxPQUFPLEtBQVAsT0FBTyxRQUdsQjtJQUVELElBQVksU0FHWDtJQUhELFdBQVksU0FBUztRQUNu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
