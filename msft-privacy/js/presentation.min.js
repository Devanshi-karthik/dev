!function(){"use strict";var e,r,w,i,S,t,_=function(){return(_=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function n(e,s,a,l){return new(a=a||Promise)(function(n,t){function o(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(o,r)}i((l=l.apply(e,s||[])).next())})}function f(o,r){var i,s,a,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,s&&(a=2&t[0]?s.return:t[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,t[1])).done)return a;switch(s=0,(t=a?[2&t[0],a.value]:t)[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,s=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(o,l)}catch(e){t=[6,e],s=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function g(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s}function p(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||((o=o||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}(o=e=e||{}).ConsentChanged="ConsentChanged",o.ShowConsentNotice="ShowConsentNotice",o.ShowFirstPage="ShowFirstPage",o.CloseConsentNotice="CloseConsentNotice",o.AcceptAll="AcceptAll",o.RejectAll="RejectAll",o.ShowTemplate="ShowTemplate",o.CloseTemplate="CloseTemplate",o.UpdateConsent="UpdateConsent",o.AnchorTagClicked="AnchorTagClicked",o.FetchConfig="FetchConfig",o.QuestionsFormSubmitWithoutMetaData="QuestionsFormSubmitWithoutMetaData",o.QuestionsFormSubmit="QuestionsFormSubmit",o.ShowPreferences="ShowPreferences",o.ConsentPreference="MSFTConsentPreference",(o=r=r||{}).Url="Url",o.Text="Text",(o=w=w||{}).TrackerCategory="trackerCategory",o.Questions="Questions",(i=i||{}).TemplateError="<b>There is something wrong with template. Please check logs.</b>",(o=S=S||{}).WebConsentModel="WebConsentModel",o.QuestionModel="DSRSubmissionModel",(t=t||{}).Preferences="Preferences";s.registerShowTemplateHandlers=function(){window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.PublicEvents.ShowConsentNotice,s.showFirstPage),window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.PublicEvents.CloseConsentNotice,s.hideConsentNotice),window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.Events.Init,s.saveStylesOnInit),window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.PublicEvents.ShowTemplate,s.showTemplate),window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.PublicEvents.CloseTemplate,s.closeTemplate),window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.Events.ConfigReady,s.init),window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.PublicEvents.ShowPreferences,s.showPreferences)},s.showPreferences=function(){try{s.showTemplate({templateId:t.Preferences})}catch(e){s.showFirstPage()}},s.showTemplate=function(e){e=e.templateId;if(!window.__MSFT_SDK.Store.getters.components||!window.__MSFT_SDK.Store.getters.components[e])throw new Error("Template : ".concat(e," not found."));var t=window.__MSFT_SDK.Store.getters.currentModel;s.showTemplateInIFrame(window.__MSFT_SDK.Store.getters.components[e],e,[{type:r.Text,value:(null==t?void 0:t.layout.ui.css)||""}],s.getParentElement(e))},s.closeTemplate=function(e){e=e.templateId;s.closeIFrame(e)},s.saveStylesOnInit=function(e){e.styles&&(window.__MSFT_SDK.Logger.info("user provided styles persisted to window.__MSFT_SDK.Store."),window.__MSFT_SDK.Store.reducers.setStyles(e.styles))},s.validationArrayToObject=function(e){return e.reduce(function(e,t){return _(_({},e),((e={})[t]=!0,e))},{})},s.getTemplateData=function(d){return n(this,void 0,void 0,function(){var t,n,o,r,i,s,a,l,c,u=this;return f(this,function(e){switch(e.label){case 0:return t=window.__MSFT_SDK.Store.getters.translations,n=window.__MSFT_SDK.Store.getters.questions,r={},(o={})[w.TrackerCategory]=[],o[w.Questions]=[],[4,window.MSFTConsent.getConsent()];case 1:return i=e.sent().preferences,s=new Map,a=new Map,l=new Set,c=new Set,d.kind===S.WebConsentModel?window.__MSFT_SDK.Store.getters.bannerTrackerCategories.forEach(function(e){s.set(e.id,e)}):d.kind===S.QuestionModel&&(n.forEach(function(e){a.set(e.name,e)}),o.captcha=d.captcha),t.forEach(function(n){return Object.keys(n).forEach(function(t){var e;"model"===t?o=_(_({},o),n[t]):a.has(t)&&!l.has(t)?((r=_(_(_({},n[t]),a.get(t)),{validations:u.validationArrayToObject((null==(e=a.get(t))?void 0:e.validations)||[])})).validations=_(_({},r.validations),u.validationArrayToObject((null==(e=d.questions.find(function(e){return e.questionName==t}))?void 0:e.validations)||[])),o[w.Questions].push(r),l.add(t)):d.kind===S.QuestionModel?o=_(_({},o),((e={})[t]=n[t],e)):s.has(t)&&!c.has(t)&&(e=_(_({},n[t]),{name:null==(e=s.get(t))?void 0:e.categoryName,isEssential:null==(e=s.get(t))?void 0:e.isEssential,isOn:"1"===i[(null==(e=s.get(t))?void 0:e.categoryName)||""]}),o[w.TrackerCategory].push(e),c.add(t))})}),o[w.TrackerCategory]=p(p([],g(o[w.TrackerCategory].filter(function(e){return e.isEssential})),!1),g(o[w.TrackerCategory].filter(function(e){return!e.isEssential})),!1),o["msft-script-open"]="<script>",o["msft-script-close"]="<\/script>",window.__MSFT_SDK.Logger.info("getTemplate data invoked",{consentModel:d,data:o}),[2,_(_(_({},o),window.__MSFT_SDK.Store.getters.templateData),{consentModel:d})]}})})},s.init=function(){return n(this,void 0,void 0,function(){var t,n,o;return f(this,function(e){switch(e.label){case 0:return(window.Handlebars&&(window.Handlebars.registerHelper("toLowerCase",function(e){return e.toLowerCase()}),window.Handlebars.registerHelper("equals",function(e,t){return e.toLowerCase()===t.toLowerCase()})),void 0===window.__MSFT_SDK.Store.getters.currentModel||void 0===window.__MSFT_SDK.Store.getters.template)?(window.__MSFT_SDK.Logger.warn("Cannot call init before config is ready."),[2]):(t=window.__MSFT_SDK.Store.getters.currentModel,n=window.__MSFT_SDK.Store.getters.template,[4,s.getTemplateData(t)]);case 1:return o=e.sent(),n.pages.forEach(function(e){var t;try{var n=window.Handlebars.compile(e.css+e.content)(o)}catch(e){window.__MSFT_SDK.Logger.error(e.message,e),n=i.TemplateError}window.__MSFT_SDK.Store.reducers.setComponents(_(_({},window.__MSFT_SDK.Store.getters.components),((t={})[e.name]=n,t)))}),window.__MSFT_SDK.Logger.info("Components updated"),s.initialized=!0,window.__MSFT_SDK.EventBus.on(window.__MSFT_SDK.enums.PublicEvents.ShowFirstPage,s.showFirstPage),[2]}})})},s.showFirstPage=function(){return n(this,void 0,void 0,function(){var t,n,o;return f(this,function(e){switch(e.label){case 0:return s.initialized?[3,2]:[4,s.init()];case 1:e.sent(),e.label=2;case 2:return void 0===(t=window.__MSFT_SDK.Store.getters.currentModel)?(window.__MSFT_SDK.Logger.warn("Cannot call init before consent model is selected."),[2]):(n=window.__MSFT_SDK.Store.getters.startingLayoutPage,void 0===window.__MSFT_SDK.Store.getters.components||void 0===n||void 0===window.__MSFT_SDK.Store.getters.components[n]?window.__MSFT_SDK.Logger.error("Notice template not found."):(o=window.__MSFT_SDK.Store.getters.components[n],s.showTemplateInIFrame(o,n,[{type:r.Text,value:t.layout.ui.css||""}],s.getParentElement(n))),[2])}})})},s.getParentElement=function(e){var t=((null==(t=window.__MSFT_SDK.Store.getters.config.initConfig)?void 0:t.componentParentMap)||window.__MSFT_SDK.Store.getters.templateParentMap)[e];return t?document.getElementById(t):null},s.showTemplateInIFrame=function(e,t,n,o){var r;void 0===n&&(n=[]),document.getElementById(t)?window.__MSFT_SDK.Logger.info("Template: ".concat(t," is already open.")):(e!==i.TemplateError||window.__MSFT_SDK.Store.getters.isLivePreviewMode&&window.__MSFT_SDK.Store.getters.isPreviewMode)&&(r={origin:window.origin,renderTemplateWithoutIframe:null==(r=window.__MSFT_SDK.Store.getters.config.initConfig)?void 0:r.renderTemplateWithoutIframe,executionContexts:(null==(r=window.__MSFT_SDK.Store.getters.config.initConfig)?void 0:r.executionContexts)||[]},e="<script>var msftData = ".concat(JSON.stringify(r),"<\/script> \n        <script>").concat(window.__MSFT_SDK.Store.getters.proxyJS,"<\/script>")+e,window.__MSFT_SDK.Utils.IFrameUtils.createIFrame(e,t,o,n))},s.hideConsentNotice=function(){var e;void 0===window.__MSFT_SDK.Store.getters.currentModel?window.__MSFT_SDK.Logger.warn("Cannot call hideConsentNotice before consent model is selected."):(e=window.__MSFT_SDK.Store.getters.startingLayoutPage)&&s.closeIFrame(e)},s.closeIFrame=function(e){var t,e=document.getElementById(e);null!=(t=null==e?void 0:e.parentElement)&&t.removeChild(e)},s.initialized=!1;var o=s;function s(){s.registerShowTemplateHandlers()}window.onmessage=function(o){return n(void 0,void 0,void 0,function(){var t,n;return f(this,function(e){switch(e.label){case 0:return"null"!==o.origin?[3,3]:window.__MSFT_SDK.Store.getters.isActionDisabled&&"trigger"===o.data.method?[2]:(t=(t=window.MSFTConsent)[o.data.method].apply(t,p([],g(o.data.params),!1)))instanceof Promise?[4,t]:[3,2];case 1:t=e.sent(),e.label=2;case 2:o.data.responseId&&null!=(n=o.source)&&n.postMessage(_(_({},o.data),{response:t}),{targetOrigin:"*"}),e.label=3;case 3:return[2]}})})},window.__MSFT_SDK.EventBus.on(e.AnchorTagClicked,function(e){var t=e.attributes,n=document.createElement("a");Object.keys(t).forEach(function(e){n.setAttribute(e,t[e])}),n.click()}),new o}();
