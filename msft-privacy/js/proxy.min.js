(function () {
    'use strict';

    var AsyncUtils = /** @class */ (function () {
        function AsyncUtils() {
        }
        AsyncUtils.deferred = function () {
            var defer = {};
            defer.promise = new Promise(function (res, rej) {
                defer.resolve = res;
                defer.reject = rej;
            });
            return defer;
        };
        return AsyncUtils;
    }());

    var promiseMap = {};
    var sendMessage = function (method, args, responseId) {
        if (parent) {
            parent.postMessage({ method: method, params: Object.values(args), responseId: responseId }, msftData.origin);
        }
    };
    var callMethod = function (method, args) {
        var responseId = "".concat(method, "-").concat(new Date().getTime());
        var deferred = AsyncUtils.deferred();
        promiseMap[responseId] = deferred;
        sendMessage(method, args, responseId);
        return deferred.promise;
    };
    window.onmessage = function (e) {
        var _a;
        if (e.origin === msftData.origin && ((_a = e === null || e === void 0 ? void 0 : e.data) === null || _a === void 0 ? void 0 : _a.responseId)) {
            e.data.error
                ? promiseMap[e.data.responseId].reject(e.data.error)
                : promiseMap[e.data.responseId].resolve(e.data.response);
        }
    };

    var ConsentModelType;
    (function (ConsentModelType) {
        ConsentModelType["Explicit"] = "Explicit";
        ConsentModelType["Implicit"] = "Implicit";
    })(ConsentModelType || (ConsentModelType = {}));
    var PublicEvents;
    (function (PublicEvents) {
        PublicEvents["ConsentChanged"] = "ConsentChanged";
        PublicEvents["ShowConsentNotice"] = "ShowConsentNotice";
        PublicEvents["ShowFirstPage"] = "ShowFirstPage";
        PublicEvents["CloseConsentNotice"] = "CloseConsentNotice";
        PublicEvents["AcceptAll"] = "AcceptAll";
        PublicEvents["RejectAll"] = "RejectAll";
        PublicEvents["ShowTemplate"] = "ShowTemplate";
        PublicEvents["CloseTemplate"] = "CloseTemplate";
        PublicEvents["UpdateConsent"] = "UpdateConsent";
        PublicEvents["AnchorTagClicked"] = "AnchorTagClicked";
        PublicEvents["FetchConfig"] = "FetchConfig";
        PublicEvents["QuestionsFormSubmitWithoutMetaData"] = "QuestionsFormSubmitWithoutMetaData";
        PublicEvents["QuestionsFormSubmit"] = "QuestionsFormSubmit";
        PublicEvents["ShowPreferences"] = "ShowPreferences";
    })(PublicEvents || (PublicEvents = {}));
    var Events;
    (function (Events) {
        Events["Init"] = "Init";
        Events["CoreConsentModelSelected"] = "CoreConsentModelSelected";
        Events["ConfigReady"] = "ConfigReady";
    })(Events || (Events = {}));
    var SDKMode;
    (function (SDKMode) {
        SDKMode["Default"] = "Default";
        SDKMode["HeadLess"] = "HeadLess";
    })(SDKMode || (SDKMode = {}));
    var StyleType;
    (function (StyleType) {
        StyleType["Url"] = "Url";
        StyleType["Text"] = "Text";
    })(StyleType || (StyleType = {}));
    var Preference;
    (function (Preference) {
        Preference["OFF"] = "0";
        Preference["ON"] = "1";
    })(Preference || (Preference = {}));
    var Cookie;
    (function (Cookie) {
        Cookie["Consent"] = "msft-consent";
    })(Cookie || (Cookie = {}));
    var RegisteredDivType;
    (function (RegisteredDivType) {
        RegisteredDivType["Script"] = "script";
        RegisteredDivType["IFrame"] = "iframe";
    })(RegisteredDivType || (RegisteredDivType = {}));
    var NoticeType;
    (function (NoticeType) {
        NoticeType["TrackerCategory"] = "trackerCategory";
    })(NoticeType || (NoticeType = {}));
    var ErrorStrings;
    (function (ErrorStrings) {
        ErrorStrings["TemplateError"] = "<b>There is something wrong with template. Please check logs.</b>";
    })(ErrorStrings || (ErrorStrings = {}));
    var IntervalUnits;
    (function (IntervalUnits) {
        IntervalUnits["day"] = "day";
        IntervalUnits["week"] = "week";
        IntervalUnits["month"] = "month";
        IntervalUnits["year"] = "year";
    })(IntervalUnits || (IntervalUnits = {}));
    var QuestionType;
    (function (QuestionType) {
        QuestionType["Text"] = "Text";
        QuestionType["Email"] = "Email";
        QuestionType["Radio"] = "Radio";
        QuestionType["MultiSelect"] = "MultiSelect";
        QuestionType["Select"] = "Select";
        QuestionType["Date"] = "Date";
        QuestionType["PhoneNumber"] = "PhoneNumber";
        QuestionType["CreditCard"] = "CreditCard";
        QuestionType["Number"] = "Number";
        QuestionType["MultiLineText"] = "multiLineText";
    })(QuestionType || (QuestionType = {}));
    var QuestionValidation;
    (function (QuestionValidation) {
        QuestionValidation["Required"] = "required";
    })(QuestionValidation || (QuestionValidation = {}));
    var QuestionField;
    (function (QuestionField) {
        QuestionField["Question"] = "question";
        QuestionField["Placeholder"] = "placeholder";
        QuestionField["Options"] = "options";
    })(QuestionField || (QuestionField = {}));
    var ModelKind;
    (function (ModelKind) {
        ModelKind["WebConsentModel"] = "WebConsentModel";
        ModelKind["QuestionModel"] = "DSRSubmissionModel";
    })(ModelKind || (ModelKind = {}));
    var Template;
    (function (Template) {
        Template["Preferences"] = "Preferences";
    })(Template || (Template = {}));

    var onclickHandler = function (e) {
        if (e.target &&
            e.target.nodeName.toLowerCase() === 'a') {
            var attributes = {};
            var attributeNames = e.target.getAttributeNames();
            e.preventDefault();
            e.stopPropagation();
            for (var i = 0; i < attributeNames.length; i++) {
                var attrName = attributeNames[i];
                attributes[attrName] =
                    e.target.getAttribute(attrName) || '';
            }
            window.MSFTConsent.trigger(PublicEvents.AnchorTagClicked, { attributes: attributes });
        }
    };
    // Options for the observer (which mutations to observe)
    var config = { childList: true, subtree: true };
    // Callback function to execute when mutations are observed
    var callback = function (mutationList) {
        mutationList.forEach(function (mutationRecord) {
            mutationRecord.addedNodes.forEach(function (addedNode) {
                if (addedNode.nodeName.toLowerCase() === 'a') {
                    addedNode.addEventListener('click', { handleEvent: onclickHandler });
                }
            });
        });
    };
    // Create an observer instance linked to the callback function
    var observer = new MutationObserver(callback);
    // Start observing the target node for configured mutations
    observer.observe(document.documentElement, config);

    if (self !== top) {
        window.MSFTConsent = {};
        var methodsWithReturnType = ['getConsent', 'getTrackerCategories'];
        var methodsWithoutReturnType = ['trigger', 'showChangeSettingsModal'];
        methodsWithoutReturnType.forEach(function (methodName) {
            window.MSFTConsent[methodName] = function () {
                var args = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    args[_i] = arguments[_i];
                }
                sendMessage(methodName, args);
            };
        });
        methodsWithReturnType.forEach(function (methodName) {
            window.MSFTConsent[methodName] = function () {
                var args = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    args[_i] = arguments[_i];
                }
                return callMethod(methodName, args);
            };
        });
    }
    window.msftCallbackFunction = function (event) {
        event.preventDefault();
        var formData = new FormData(event.target);
        var object = {};
        formData.forEach(function (value, key) {
            if (!Reflect.has(object, key)) {
                object[key] = value;
                return;
            }
            if (!Array.isArray(object[key])) {
                object[key] = [object[key]];
            }
            object[key].push(value);
        });
        window.MSFTConsent.trigger('QuestionsFormSubmitWithoutMetaData', {
            data: object,
        });
    };

}());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJveHkubWluLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9TREsvc3JjL2NvcmUvdXRpbHMvQXN5bmNVdGlscy50cyIsIi4uLy4uLy4uLy4uLy4uL1NESy9zcmMvcHJveHkvcHJveHkudHMiLCIuLi8uLi8uLi8uLi8uLi9TREsvc3JjL2NvcmUvY29uc3RhbnRzL2VudW1zLnRzIiwiLi4vLi4vLi4vLi4vLi4vU0RLL3NyYy9wcm94eS9hbmNob3JDbGlja0hhbmRsZXIudHMiLCIuLi8uLi8uLi8uLi8uLi9TREsvc3JjL3Byb3h5L2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBpbnRlcmZhY2UgSURlZmVycmVkPFQ+IHtcclxuICBwcm9taXNlOiBQcm9taXNlPFQ+O1xyXG4gIHJlc29sdmU6ICh2YWx1ZTogVCB8IFByb21pc2VMaWtlPFQ+KSA9PiB2b2lkO1xyXG4gIHJlamVjdDogKHJlYXNvbj86IGFueSkgPT4gdm9pZDtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXN5bmNVdGlscyB7XHJcbiAgcHVibGljIHN0YXRpYyBkZWZlcnJlZDxUPigpOiBJRGVmZXJyZWQ8VD4ge1xyXG4gICAgY29uc3QgZGVmZXIgPSB7fSBhcyBJRGVmZXJyZWQ8VD47XHJcbiAgICBkZWZlci5wcm9taXNlID0gbmV3IFByb21pc2U8VD4oKHJlcywgcmVqKSA9PiB7XHJcbiAgICAgIGRlZmVyLnJlc29sdmUgPSByZXM7XHJcbiAgICAgIGRlZmVyLnJlamVjdCA9IHJlajtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBkZWZlcjtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IEFzeW5jVXRpbHMsIHsgSURlZmVycmVkIH0gZnJvbSAnY29yZS91dGlscy9Bc3luY1V0aWxzJztcclxuXHJcbmNvbnN0IHByb21pc2VNYXA6IHsgW2tleTogc3RyaW5nXTogSURlZmVycmVkPGFueT4gfSA9IHt9O1xyXG5cclxuZXhwb3J0IGNvbnN0IHNlbmRNZXNzYWdlID0gKFxyXG4gIG1ldGhvZDogc3RyaW5nLFxyXG4gIGFyZ3M6IGFueVtdLFxyXG4gIHJlc3BvbnNlSWQ/OiBzdHJpbmcsXHJcbikgPT4ge1xyXG4gIGlmIChwYXJlbnQpIHtcclxuICAgIHBhcmVudC5wb3N0TWVzc2FnZShcclxuICAgICAgeyBtZXRob2Q6IG1ldGhvZCwgcGFyYW1zOiBPYmplY3QudmFsdWVzKGFyZ3MpLCByZXNwb25zZUlkIH0sXHJcbiAgICAgIG1zZnREYXRhLm9yaWdpbixcclxuICAgICk7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGNhbGxNZXRob2QgPSAobWV0aG9kOiBzdHJpbmcsIGFyZ3M6IGFueVtdKTogUHJvbWlzZTxhbnk+ID0+IHtcclxuICBjb25zdCByZXNwb25zZUlkID0gYCR7bWV0aG9kfS0ke25ldyBEYXRlKCkuZ2V0VGltZSgpfWA7XHJcbiAgY29uc3QgZGVmZXJyZWQgPSBBc3luY1V0aWxzLmRlZmVycmVkPGFueT4oKTtcclxuICBwcm9taXNlTWFwW3Jlc3BvbnNlSWRdID0gZGVmZXJyZWQ7XHJcbiAgc2VuZE1lc3NhZ2UobWV0aG9kLCBhcmdzLCByZXNwb25zZUlkKTtcclxuICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxufTtcclxuXHJcbndpbmRvdy5vbm1lc3NhZ2UgPSBlID0+IHtcclxuICBpZiAoZS5vcmlnaW4gPT09IG1zZnREYXRhLm9yaWdpbiAmJiBlPy5kYXRhPy5yZXNwb25zZUlkKSB7XHJcbiAgICBlLmRhdGEuZXJyb3JcclxuICAgICAgPyBwcm9taXNlTWFwW2UuZGF0YS5yZXNwb25zZUlkXS5yZWplY3QoZS5kYXRhLmVycm9yKVxyXG4gICAgICA6IHByb21pc2VNYXBbZS5kYXRhLnJlc3BvbnNlSWRdLnJlc29sdmUoZS5kYXRhLnJlc3BvbnNlKTtcclxuICB9XHJcbn07XHJcbiIsImV4cG9ydCBlbnVtIENvbnNlbnRNb2RlbFR5cGUge1xyXG4gIEV4cGxpY2l0ID0gJ0V4cGxpY2l0JyxcclxuICBJbXBsaWNpdCA9ICdJbXBsaWNpdCcsXHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIFB1YmxpY0V2ZW50cyB7XHJcbiAgQ29uc2VudENoYW5nZWQgPSAnQ29uc2VudENoYW5nZWQnLFxyXG4gIFNob3dDb25zZW50Tm90aWNlID0gJ1Nob3dDb25zZW50Tm90aWNlJyxcclxuICBTaG93Rmlyc3RQYWdlID0gJ1Nob3dGaXJzdFBhZ2UnLFxyXG4gIENsb3NlQ29uc2VudE5vdGljZSA9ICdDbG9zZUNvbnNlbnROb3RpY2UnLFxyXG4gIEFjY2VwdEFsbCA9ICdBY2NlcHRBbGwnLFxyXG4gIFJlamVjdEFsbCA9ICdSZWplY3RBbGwnLFxyXG4gIFNob3dUZW1wbGF0ZSA9ICdTaG93VGVtcGxhdGUnLFxyXG4gIENsb3NlVGVtcGxhdGUgPSAnQ2xvc2VUZW1wbGF0ZScsXHJcbiAgVXBkYXRlQ29uc2VudCA9ICdVcGRhdGVDb25zZW50JyxcclxuICBBbmNob3JUYWdDbGlja2VkID0gJ0FuY2hvclRhZ0NsaWNrZWQnLFxyXG4gIEZldGNoQ29uZmlnID0gJ0ZldGNoQ29uZmlnJyxcclxuICBRdWVzdGlvbnNGb3JtU3VibWl0V2l0aG91dE1ldGFEYXRhID0gJ1F1ZXN0aW9uc0Zvcm1TdWJtaXRXaXRob3V0TWV0YURhdGEnLFxyXG4gIFF1ZXN0aW9uc0Zvcm1TdWJtaXQgPSAnUXVlc3Rpb25zRm9ybVN1Ym1pdCcsXHJcbiAgU2hvd1ByZWZlcmVuY2VzID0gJ1Nob3dQcmVmZXJlbmNlcycsXHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIEV2ZW50cyB7XHJcbiAgSW5pdCA9ICdJbml0JyxcclxuICBDb3JlQ29uc2VudE1vZGVsU2VsZWN0ZWQgPSAnQ29yZUNvbnNlbnRNb2RlbFNlbGVjdGVkJyxcclxuICBDb25maWdSZWFkeSA9ICdDb25maWdSZWFkeScsXHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIFNES01vZGUge1xyXG4gIERlZmF1bHQgPSAnRGVmYXVsdCcsXHJcbiAgSGVhZExlc3MgPSAnSGVhZExlc3MnLFxyXG59XHJcblxyXG5leHBvcnQgZW51bSBTdHlsZVR5cGUge1xyXG4gIFVybCA9ICdVcmwnLFxyXG4gIFRleHQgPSAnVGV4dCcsXHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIFByZWZlcmVuY2Uge1xyXG4gIE9GRiA9ICcwJyxcclxuICBPTiA9ICcxJyxcclxufVxyXG5cclxuZXhwb3J0IGVudW0gQ29va2llIHtcclxuICBDb25zZW50ID0gJ21zZnQtY29uc2VudCcsXHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIFJlZ2lzdGVyZWREaXZUeXBlIHtcclxuICBTY3JpcHQgPSAnc2NyaXB0JyxcclxuICBJRnJhbWUgPSAnaWZyYW1lJyxcclxufVxyXG5cclxuZXhwb3J0IGVudW0gTm90aWNlVHlwZSB7XHJcbiAgVHJhY2tlckNhdGVnb3J5ID0gJ3RyYWNrZXJDYXRlZ29yeScsXHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIEVycm9yU3RyaW5ncyB7XHJcbiAgVGVtcGxhdGVFcnJvciA9ICc8Yj5UaGVyZSBpcyBzb21ldGhpbmcgd3Jvbmcgd2l0aCB0ZW1wbGF0ZS4gUGxlYXNlIGNoZWNrIGxvZ3MuPC9iPicsXHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIEludGVydmFsVW5pdHMge1xyXG4gIGRheSA9ICdkYXknLFxyXG4gIHdlZWsgPSAnd2VlaycsXHJcbiAgbW9udGggPSAnbW9udGgnLFxyXG4gIHllYXIgPSAneWVhcicsXHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIFF1ZXN0aW9uVHlwZSB7XHJcbiAgVGV4dCA9ICdUZXh0JyxcclxuICBFbWFpbCA9ICdFbWFpbCcsXHJcbiAgUmFkaW8gPSAnUmFkaW8nLFxyXG4gIE11bHRpU2VsZWN0ID0gJ011bHRpU2VsZWN0JyxcclxuICBTZWxlY3QgPSAnU2VsZWN0JyxcclxuICBEYXRlID0gJ0RhdGUnLFxyXG4gIFBob25lTnVtYmVyID0gJ1Bob25lTnVtYmVyJyxcclxuICBDcmVkaXRDYXJkID0gJ0NyZWRpdENhcmQnLFxyXG4gIE51bWJlciA9ICdOdW1iZXInLFxyXG4gIE11bHRpTGluZVRleHQgPSAnbXVsdGlMaW5lVGV4dCcsXHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIFF1ZXN0aW9uVmFsaWRhdGlvbiB7XHJcbiAgUmVxdWlyZWQgPSAncmVxdWlyZWQnLFxyXG59XHJcblxyXG5leHBvcnQgZW51bSBRdWVzdGlvbkZpZWxkIHtcclxuICBRdWVzdGlvbiA9ICdxdWVzdGlvbicsXHJcbiAgUGxhY2Vob2xkZXIgPSAncGxhY2Vob2xkZXInLFxyXG4gIE9wdGlvbnMgPSAnb3B0aW9ucycsXHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIE1vZGVsS2luZCB7XHJcbiAgV2ViQ29uc2VudE1vZGVsID0gJ1dlYkNvbnNlbnRNb2RlbCcsXHJcbiAgUXVlc3Rpb25Nb2RlbCA9ICdEU1JTdWJtaXNzaW9uTW9kZWwnLFxyXG59XHJcblxyXG5leHBvcnQgZW51bSBUZW1wbGF0ZSB7XHJcbiAgUHJlZmVyZW5jZXMgPSAnUHJlZmVyZW5jZXMnLFxyXG59XHJcbiIsImltcG9ydCB7IFB1YmxpY0V2ZW50cyB9IGZyb20gJ2NvcmUvY29uc3RhbnRzL2VudW1zJztcclxuXHJcbmNvbnN0IG9uY2xpY2tIYW5kbGVyID0gKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICBpZiAoXHJcbiAgICBlLnRhcmdldCAmJlxyXG4gICAgKGUudGFyZ2V0IGFzIEhUTUxBbmNob3JFbGVtZW50KS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnYSdcclxuICApIHtcclxuICAgIGNvbnN0IGF0dHJpYnV0ZXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSB7fTtcclxuICAgIGNvbnN0IGF0dHJpYnV0ZU5hbWVzID0gKGUudGFyZ2V0IGFzIEhUTUxBbmNob3JFbGVtZW50KS5nZXRBdHRyaWJ1dGVOYW1lcygpO1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXR0cmlidXRlTmFtZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc3QgYXR0ck5hbWUgPSBhdHRyaWJ1dGVOYW1lc1tpXTtcclxuICAgICAgYXR0cmlidXRlc1thdHRyTmFtZV0gPVxyXG4gICAgICAgIChlLnRhcmdldCBhcyBIVE1MQW5jaG9yRWxlbWVudCkuZ2V0QXR0cmlidXRlKGF0dHJOYW1lKSB8fCAnJztcclxuICAgIH1cclxuICAgIHdpbmRvdy5NU0ZUQ29uc2VudC50cmlnZ2VyKFB1YmxpY0V2ZW50cy5BbmNob3JUYWdDbGlja2VkLCB7IGF0dHJpYnV0ZXMgfSk7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gT3B0aW9ucyBmb3IgdGhlIG9ic2VydmVyICh3aGljaCBtdXRhdGlvbnMgdG8gb2JzZXJ2ZSlcclxuY29uc3QgY29uZmlnID0geyBjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWUgfTtcclxuXHJcbi8vIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgd2hlbiBtdXRhdGlvbnMgYXJlIG9ic2VydmVkXHJcbmNvbnN0IGNhbGxiYWNrOiBNdXRhdGlvbkNhbGxiYWNrID0gZnVuY3Rpb24gKG11dGF0aW9uTGlzdCkge1xyXG4gIG11dGF0aW9uTGlzdC5mb3JFYWNoKG11dGF0aW9uUmVjb3JkID0+IHtcclxuICAgIG11dGF0aW9uUmVjb3JkLmFkZGVkTm9kZXMuZm9yRWFjaChhZGRlZE5vZGUgPT4ge1xyXG4gICAgICBpZiAoYWRkZWROb2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdhJykge1xyXG4gICAgICAgIGFkZGVkTm9kZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHsgaGFuZGxlRXZlbnQ6IG9uY2xpY2tIYW5kbGVyIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9KTtcclxufTtcclxuXHJcbi8vIENyZWF0ZSBhbiBvYnNlcnZlciBpbnN0YW5jZSBsaW5rZWQgdG8gdGhlIGNhbGxiYWNrIGZ1bmN0aW9uXHJcbmNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoY2FsbGJhY2spO1xyXG5cclxuLy8gU3RhcnQgb2JzZXJ2aW5nIHRoZSB0YXJnZXQgbm9kZSBmb3IgY29uZmlndXJlZCBtdXRhdGlvbnNcclxub2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIGNvbmZpZyk7XHJcbiIsImltcG9ydCB7IGNhbGxNZXRob2QsIHNlbmRNZXNzYWdlIH0gZnJvbSAnLi9wcm94eSc7XHJcbmltcG9ydCAnLi9hbmNob3JDbGlja0hhbmRsZXInO1xyXG5cclxuaWYgKHNlbGYgIT09IHRvcCkge1xyXG4gIHdpbmRvdy5NU0ZUQ29uc2VudCA9IHt9IGFzIGFueTtcclxuXHJcbiAgY29uc3QgbWV0aG9kc1dpdGhSZXR1cm5UeXBlID0gWydnZXRDb25zZW50JywgJ2dldFRyYWNrZXJDYXRlZ29yaWVzJ107XHJcbiAgY29uc3QgbWV0aG9kc1dpdGhvdXRSZXR1cm5UeXBlID0gWyd0cmlnZ2VyJywgJ3Nob3dDaGFuZ2VTZXR0aW5nc01vZGFsJ107XHJcblxyXG4gIG1ldGhvZHNXaXRob3V0UmV0dXJuVHlwZS5mb3JFYWNoKG1ldGhvZE5hbWUgPT4ge1xyXG4gICAgKHdpbmRvdy5NU0ZUQ29uc2VudCBhcyBhbnkpW21ldGhvZE5hbWVdID0gKC4uLmFyZ3M6IGFueVtdKTogdm9pZCA9PiB7XHJcbiAgICAgIHNlbmRNZXNzYWdlKG1ldGhvZE5hbWUsIGFyZ3MpO1xyXG4gICAgfTtcclxuICB9KTtcclxuXHJcbiAgbWV0aG9kc1dpdGhSZXR1cm5UeXBlLmZvckVhY2gobWV0aG9kTmFtZSA9PiB7XHJcbiAgICAod2luZG93Lk1TRlRDb25zZW50IGFzIGFueSlbbWV0aG9kTmFtZV0gPSAoXHJcbiAgICAgIC4uLmFyZ3M6IGFueVtdXHJcbiAgICApOiBQcm9taXNlPGFueT4gPT4ge1xyXG4gICAgICByZXR1cm4gY2FsbE1ldGhvZChtZXRob2ROYW1lLCBhcmdzKTtcclxuICAgIH07XHJcbiAgfSk7XHJcbn1cclxuXHJcbih3aW5kb3cgYXMgYW55KS5tc2Z0Q2FsbGJhY2tGdW5jdGlvbiA9IChldmVudDogYW55KSA9PiB7XHJcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YShldmVudC50YXJnZXQpO1xyXG4gIGNvbnN0IG9iamVjdCA9IHt9IGFzIGFueTtcclxuICBmb3JtRGF0YS5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7XHJcbiAgICBpZiAoIVJlZmxlY3QuaGFzKG9iamVjdCwga2V5KSkge1xyXG4gICAgICBvYmplY3Rba2V5XSA9IHZhbHVlO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqZWN0W2tleV0pKSB7XHJcbiAgICAgIG9iamVjdFtrZXldID0gW29iamVjdFtrZXldXTtcclxuICAgIH1cclxuICAgIG9iamVjdFtrZXldLnB1c2godmFsdWUpO1xyXG4gIH0pO1xyXG4gIHdpbmRvdy5NU0ZUQ29uc2VudC50cmlnZ2VyKCdRdWVzdGlvbnNGb3JtU3VibWl0V2l0aG91dE1ldGFEYXRhJywge1xyXG4gICAgZGF0YTogb2JqZWN0LFxyXG4gIH0pO1xyXG59O1xyXG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0lBTUE7UUFBQTtTQVVDO1FBVGUsbUJBQVEsR0FBdEI7WUFDRSxJQUFNLEtBQUssR0FBRyxFQUFrQixDQUFDO1lBQ2pDLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxPQUFPLENBQUksVUFBQyxHQUFHLEVBQUUsR0FBRztnQkFDdEMsS0FBSyxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUM7Z0JBQ3BCLEtBQUssQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDO2FBQ3BCLENBQUMsQ0FBQztZQUVILE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFDSCxpQkFBQztJQUFELENBQUM7O0lDZEQsSUFBTSxVQUFVLEdBQXNDLEVBQUUsQ0FBQztJQUVsRCxJQUFNLFdBQVcsR0FBRyxVQUN6QixNQUFjLEVBQ2QsSUFBVyxFQUNYLFVBQW1CO1FBRW5CLElBQUksTUFBTSxFQUFFO1lBQ1YsTUFBTSxDQUFDLFdBQVcsQ0FDaEIsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLFVBQVUsWUFBQSxFQUFFLEVBQzNELFFBQVEsQ0FBQyxNQUFNLENBQ2hCLENBQUM7U0FDSDtJQUNILENBQUMsQ0FBQztJQUVLLElBQU0sVUFBVSxHQUFHLFVBQUMsTUFBYyxFQUFFLElBQVc7UUFDcEQsSUFBTSxVQUFVLEdBQUcsVUFBRyxNQUFNLGNBQUksSUFBSSxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsQ0FBRSxDQUFDO1FBQ3ZELElBQU0sUUFBUSxHQUFHLFVBQVUsQ0FBQyxRQUFRLEVBQU8sQ0FBQztRQUM1QyxVQUFVLENBQUMsVUFBVSxDQUFDLEdBQUcsUUFBUSxDQUFDO1FBQ2xDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQ3RDLE9BQU8sUUFBUSxDQUFDLE9BQU8sQ0FBQztJQUMxQixDQUFDLENBQUM7SUFFRixNQUFNLENBQUMsU0FBUyxHQUFHLFVBQUEsQ0FBQzs7UUFDbEIsSUFBSSxDQUFDLENBQUMsTUFBTSxLQUFLLFFBQVEsQ0FBQyxNQUFNLEtBQUksTUFBQSxDQUFDLGFBQUQsQ0FBQyx1QkFBRCxDQUFDLENBQUUsSUFBSSwwQ0FBRSxVQUFVLENBQUEsRUFBRTtZQUN2RCxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUs7a0JBQ1IsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO2tCQUNsRCxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUM1RDtJQUNILENBQUM7O0lDL0JELElBQVksZ0JBR1g7SUFIRCxXQUFZLGdCQUFnQjtRQUMxQix5Q0FBcUIsQ0FBQTtRQUNyQix5Q0FBcUIsQ0FBQTtJQUN2QixDQUFDLEVBSFcsZ0JBQWdCLEtBQWhCLGdCQUFnQixRQUczQjtJQUVELElBQVksWUFlWDtJQWZELFdBQVksWUFBWTtRQUN0QixpREFBaUMsQ0FBQTtRQUNqQyx1REFBdUMsQ0FBQTtRQUN2QywrQ0FBK0IsQ0FBQTtRQUMvQix5REFBeUMsQ0FBQTtRQUN6Qyx1Q0FBdUIsQ0FBQTtRQUN2Qix1Q0FBdUIsQ0FBQTtRQUN2Qiw2Q0FBNkIsQ0FBQTtRQUM3QiwrQ0FBK0IsQ0FBQTtRQUMvQiwrQ0FBK0IsQ0FBQTtRQUMvQixxREFBcUMsQ0FBQTtRQUNyQywyQ0FBMkIsQ0FBQTtRQUMzQix5RkFBeUUsQ0FBQTtRQUN6RSwyREFBMkMsQ0FBQTtRQUMzQyxtREFBbUMsQ0FBQTtJQUNyQyxDQUFDLEVBZlcsWUFBWSxLQUFaLFlBQVksUUFldkI7SUFFRCxJQUFZLE1BSVg7SUFKRCxXQUFZLE1BQU07UUFDaEIsdUJBQWEsQ0FBQTtRQUNiLCtEQUFxRCxDQUFBO1FBQ3JELHFDQUEyQixDQUFBO0lBQzdCLENBQUMsRUFKVyxNQUFNLEtBQU4sTUFBTSxRQUlqQjtJQUVELElBQVksT0FHWDtJQUhELFdBQVksT0FBTztRQUNqQiw4QkFBbUIsQ0FBQTtRQUNuQixnQ0FBcUIsQ0FBQTtJQUN2QixDQUFDLEVBSFcsT0FBTyxLQUFQLE9BQU8sUUFHbEI7SUFFRCxJQUFZLFNBR1g7SUFIRCxXQUFZLFNBQVM7UUFDbkIsd0JBQVcsQ0FBQTtRQUNYLDBCQUFhLENBQUE7SUFDZixDQUFDLEVBSFcsU0FBUyxLQUFULFNBQVMsUUFHcEI7SUFFRCxJQUFZLFVBR1g7SUFIRCxXQUFZLFVBQVU7UUFDcEIsdUJBQVMsQ0FBQTtRQUNULHNCQUFRLENBQUE7SUFDVixDQUFDLEVBSFcsVUFBVSxLQUFWLFVBQVUsUUFHckI7SUFFRCxJQUFZLE1BRVg7SUFGRCxXQUFZLE1BQU07UUFDaEIsa0NBQXdCLENBQUE7SUFDMUIsQ0FBQyxFQUZXLE1BQU0sS0FBTixNQUFNLFFBRWpCO0lBRUQsSUFBWSxpQkFHWDtJQUhELFdBQVksaUJBQWlCO1FBQzNCLHNDQUFpQixDQUFBO1FBQ2pCLHNDQUFpQixDQUFBO0lBQ25CLENBQUMsRUFIVyxpQkFBaUIsS0FBakIsaUJBQWlCLFFBRzVCO0lBRUQsSUFBWSxVQUVYO0lBRkQsV0FBWSxVQUFVO1FBQ3BCLGlEQUFtQyxDQUFBO0lBQ3JDLENBQUMsRUFGVyxVQUFVLEtBQVYsVUFBVSxRQUVyQjtJQUVELElBQVksWUFFWDtJQUZELFdBQVksWUFBWTtRQUN0QixtR0FBbUYsQ0FBQTtJQUNyRixDQUFDLEVBRlcsWUFBWSxLQUFaLFlBQVksUUFFdkI7SUFFRCxJQUFZLGFBS1g7SUFMRCxXQUFZLGFBQWE7UUFDdkIsNEJBQVcsQ0FBQTtRQUNYLDhCQUFhLENBQUE7UUFDYixnQ0FBZSxDQUFBO1FBQ2YsOEJBQWEsQ0FBQTtJQUNmLENBQUMsRUFMVyxhQUFhLEtBQWIsYUFBYSxRQUt4QjtJQUVELElBQVksWUFXWDtJQVhELFdBQVksWUFBWTtRQUN0Qiw2QkFBYSxDQUFBO1FBQ2IsK0JBQWUsQ0FBQTtRQUNmLCtCQUFlLENBQUE7UUFDZiwyQ0FBMkIsQ0FBQTtRQUMzQixpQ0FBaUIsQ0FBQTtRQUNqQiw2QkFBYSxDQUFBO1FBQ2IsMkNBQTJCLENBQUE7UUFDM0IseUNBQXlCLENBQUE7UUFDekIsaUNBQWlCLENBQUE7UUFDakIsK0NBQStCLENBQUE7SUFDakMsQ0FBQyxFQVhXLFlBQVksS0FBWixZQUFZLFFBV3ZCO0lBRUQsSUFBWSxrQkFFWDtJQUZELFdBQVksa0JBQWtCO1FBQzVCLDJDQUFxQixDQUFBO0lBQ3ZCLENBQUMsRUFGVyxrQkFBa0IsS0FBbEIsa0JBQWtCLFFBRTdCO0lBRUQsSUFBWSxhQUlYO0lBSkQsV0FBWSxhQUFhO1FBQ3ZCLHNDQUFxQixDQUFBO1FBQ3JCLDRDQUEyQixDQUFBO1FBQzNCLG9DQUFtQixDQUFBO0lBQ3JCLENBQUMsRUFKVyxhQUFhLEtBQWIsYUFBYSxRQUl4QjtJQUVELElBQVksU0FHWDtJQUhELFdBQVksU0FBUztRQUNuQixnREFBbUMsQ0FBQTtRQUNuQyxpREFBb0MsQ0FBQTtJQUN0QyxDQUFDLEVBSFcsU0FBUyxLQUFULFNBQVMsUUFHcEI7SUFFRCxJQUFZLFFBRVg7SUFGRCxXQUFZLFFBQVE7UUFDbEIsdUNBQTJCLENBQUE7SUFDN0IsQ0FBQyxFQUZXLFFBQVEsS0FBUixRQUFROztJQzdGcEIsSUFBTSxjQUFjLEdBQUcsVUFBQyxDQUFhO1FBQ25DLElBQ0UsQ0FBQyxDQUFDLE1BQU07WUFDUCxDQUFDLENBQUMsTUFBNEIsQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLEtBQUssR0FBRyxFQUM5RDtZQUNBLElBQU0sVUFBVSxHQUE4QixFQUFFLENBQUM7WUFDakQsSUFBTSxjQUFjLEdBQUksQ0FBQyxDQUFDLE1BQTRCLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUMzRSxDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7WUFDbkIsQ0FBQyxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQ3BCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxjQUFjLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUM5QyxJQUFNLFFBQVEsR0FBRyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ25DLFVBQVUsQ0FBQyxRQUFRLENBQUM7b0JBQ2pCLENBQUMsQ0FBQyxNQUE0QixDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7YUFDaEU7WUFDRCxNQUFNLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsZ0JBQWdCLEVBQUUsRUFBRSxVQUFVLFlBQUEsRUFBRSxDQUFDLENBQUM7U0FDM0U7SUFDSCxDQUFDLENBQUM7SUFFRjtJQUNBLElBQU0sTUFBTSxHQUFHLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUM7SUFFbEQ7SUFDQSxJQUFNLFFBQVEsR0FBcUIsVUFBVSxZQUFZO1FBQ3ZELFlBQVksQ0FBQyxPQUFPLENBQUMsVUFBQSxjQUFjO1lBQ2pDLGNBQWMsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFVBQUEsU0FBUztnQkFDekMsSUFBSSxTQUFTLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxLQUFLLEdBQUcsRUFBRTtvQkFDNUMsU0FBUyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxFQUFFLFdBQVcsRUFBRSxjQUFjLEVBQUUsQ0FBQyxDQUFDO2lCQUN0RTthQUNGLENBQUMsQ0FBQztTQUNKLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQztJQUVGO0lBQ0EsSUFBTSxRQUFRLEdBQUcsSUFBSSxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUVoRDtJQUNBLFFBQVEsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLGVBQWUsRUFBRSxNQUFNLENBQUM7O0lDbkNsRCxJQUFJLElBQUksS0FBSyxHQUFHLEVBQUU7UUFDaEIsTUFBTSxDQUFDLFdBQVcsR0FBRyxFQUFTLENBQUM7UUFFL0IsSUFBTSxxQkFBcUIsR0FBRyxDQUFDLFlBQVksRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO1FBQ3JFLElBQU0sd0JBQXdCLEdBQUcsQ0FBQyxTQUFTLEVBQUUseUJBQXlCLENBQUMsQ0FBQztRQUV4RSx3QkFBd0IsQ0FBQyxPQUFPLENBQUMsVUFBQSxVQUFVO1lBQ3hDLE1BQU0sQ0FBQyxXQUFtQixDQUFDLFVBQVUsQ0FBQyxHQUFHO2dCQUFDLGNBQWM7cUJBQWQsVUFBYyxFQUFkLHFCQUFjLEVBQWQsSUFBYztvQkFBZCx5QkFBYzs7Z0JBQ3ZELFdBQVcsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7YUFDL0IsQ0FBQztTQUNILENBQUMsQ0FBQztRQUVILHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxVQUFBLFVBQVU7WUFDckMsTUFBTSxDQUFDLFdBQW1CLENBQUMsVUFBVSxDQUFDLEdBQUc7Z0JBQ3hDLGNBQWM7cUJBQWQsVUFBYyxFQUFkLHFCQUFjLEVBQWQsSUFBYztvQkFBZCx5QkFBYzs7Z0JBRWQsT0FBTyxVQUFVLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO2FBQ3JDLENBQUM7U0FDSCxDQUFDLENBQUM7S0FDSjtJQUVBLE1BQWMsQ0FBQyxvQkFBb0IsR0FBRyxVQUFDLEtBQVU7UUFDaEQsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3ZCLElBQU0sUUFBUSxHQUFHLElBQUksUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM1QyxJQUFNLE1BQU0sR0FBRyxFQUFTLENBQUM7UUFDekIsUUFBUSxDQUFDLE9BQU8sQ0FBQyxVQUFDLEtBQUssRUFBRSxHQUFHO1lBQzFCLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRTtnQkFDN0IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQztnQkFDcEIsT0FBTzthQUNSO1lBQ0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7Z0JBQy9CLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2FBQzdCO1lBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUN6QixDQUFDLENBQUM7UUFDSCxNQUFNLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxvQ0FBb0MsRUFBRTtZQUMvRCxJQUFJLEVBQUUsTUFBTTtTQUNiLENBQUMsQ0FBQztJQUNMLENBQUM7Ozs7OzsifQ==
